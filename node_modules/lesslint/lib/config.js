'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.loadConfig = loadConfig;
exports.clearStorage = clearStorage;

var _manis = require('manis');

var _manis2 = _interopRequireDefault(_manis);

var _path = require('path');

var _jsYaml = require('js-yaml');

var _jsYaml2 = _interopRequireDefault(_jsYaml);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

'use strict'; /**
               * @file 对配置文件的读取合并等等
               * @author ielgnaw(wuji0223@gmail.com)
               */

var STORAGE = null;

/**
 * 获取 merge 后的配置文件
 * 用户自定义的配置文件优先级 .lesslintrc > config.yml > config.json
 *
 * @param {string} filePath 待检查的文件路径，根据这个路径去寻找用户自定义的配置文件，然后和默认的配置文件 merge
 * @param {boolean} refresh 是否强制刷新内存中已经存在的配置
 *
 * @return {Object} merge 后的配置对象
 */
function loadConfig(filePath, refresh) {
    if (refresh && STORAGE) {
        return STORAGE;
    }

    var manis = new _manis2.default({
        files: ['.lesslintrc'],
        loader: function loader(content) {
            if (!content) {
                return '';
            }
            var ret = void 0;
            try {
                ret = _jsYaml2.default.load(content);
            } catch (e) {}
            return ret;
        }
    });

    manis.setDefault((0, _path.join)(__dirname, './config.yml'));

    STORAGE = manis.from(filePath);

    return STORAGE;
}

/**
 * 清空 STORAGE
 */
function clearStorage() {
    STORAGE = null;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25maWcuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7UUFzQmdCLFUsR0FBQSxVO1FBZ0NBLFksR0FBQSxZOztBQWpEaEI7Ozs7QUFDQTs7QUFDQTs7Ozs7O0FBRUEsYSxDQVRBOzs7OztBQVdBLElBQUksVUFBVSxJQUFkOztBQUVBOzs7Ozs7Ozs7QUFTTyxTQUFTLFVBQVQsQ0FBb0IsUUFBcEIsRUFBOEIsT0FBOUIsRUFBdUM7QUFDMUMsUUFBSSxXQUFXLE9BQWYsRUFBd0I7QUFDcEIsZUFBTyxPQUFQO0FBQ0g7O0FBRUQsUUFBSSxRQUFRLG9CQUFVO0FBQ2xCLGVBQU8sQ0FDSCxhQURHLENBRFc7QUFJbEIsY0FKa0Isa0JBSVgsT0FKVyxFQUlGO0FBQ1osZ0JBQUksQ0FBQyxPQUFMLEVBQWM7QUFDVix1QkFBTyxFQUFQO0FBQ0g7QUFDRCxnQkFBSSxZQUFKO0FBQ0EsZ0JBQUk7QUFDQSxzQkFBTSxpQkFBSyxJQUFMLENBQVUsT0FBVixDQUFOO0FBQ0gsYUFGRCxDQUdBLE9BQU8sQ0FBUCxFQUFVLENBQUU7QUFDWixtQkFBTyxHQUFQO0FBQ0g7QUFkaUIsS0FBVixDQUFaOztBQWlCQSxVQUFNLFVBQU4sQ0FBaUIsZ0JBQUssU0FBTCxFQUFnQixjQUFoQixDQUFqQjs7QUFFQSxjQUFVLE1BQU0sSUFBTixDQUFXLFFBQVgsQ0FBVjs7QUFFQSxXQUFPLE9BQVA7QUFDSDs7QUFFRDs7O0FBR08sU0FBUyxZQUFULEdBQXdCO0FBQzNCLGNBQVUsSUFBVjtBQUNIIiwiZmlsZSI6ImNvbmZpZy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUg5a+56YWN572u5paH5Lu255qE6K+75Y+W5ZCI5bm2562J562JXG4gKiBAYXV0aG9yIGllbGduYXcod3VqaTAyMjNAZ21haWwuY29tKVxuICovXG5cbmltcG9ydCBNYW5pcyBmcm9tICdtYW5pcyc7XG5pbXBvcnQge2pvaW59IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHlhbWwgZnJvbSAnanMteWFtbCc7XG5cbid1c2Ugc3RyaWN0JztcblxubGV0IFNUT1JBR0UgPSBudWxsO1xuXG4vKipcbiAqIOiOt+WPliBtZXJnZSDlkI7nmoTphY3nva7mlofku7ZcbiAqIOeUqOaIt+iHquWumuS5ieeahOmFjee9ruaWh+S7tuS8mOWFiOe6pyAubGVzc2xpbnRyYyA+IGNvbmZpZy55bWwgPiBjb25maWcuanNvblxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlUGF0aCDlvoXmo4Dmn6XnmoTmlofku7bot6/lvoTvvIzmoLnmja7ov5nkuKrot6/lvoTljrvlr7vmib7nlKjmiLfoh6rlrprkuYnnmoTphY3nva7mlofku7bvvIznhLblkI7lkozpu5jorqTnmoTphY3nva7mlofku7YgbWVyZ2VcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gcmVmcmVzaCDmmK/lkKblvLrliLbliLfmlrDlhoXlrZjkuK3lt7Lnu4/lrZjlnKjnmoTphY3nva5cbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IG1lcmdlIOWQjueahOmFjee9ruWvueixoVxuICovXG5leHBvcnQgZnVuY3Rpb24gbG9hZENvbmZpZyhmaWxlUGF0aCwgcmVmcmVzaCkge1xuICAgIGlmIChyZWZyZXNoICYmIFNUT1JBR0UpIHtcbiAgICAgICAgcmV0dXJuIFNUT1JBR0U7XG4gICAgfVxuXG4gICAgbGV0IG1hbmlzID0gbmV3IE1hbmlzKHtcbiAgICAgICAgZmlsZXM6IFtcbiAgICAgICAgICAgICcubGVzc2xpbnRyYydcbiAgICAgICAgXSxcbiAgICAgICAgbG9hZGVyKGNvbnRlbnQpIHtcbiAgICAgICAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCByZXQ7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldCA9IHlhbWwubG9hZChjb250ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7fVxuICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWFuaXMuc2V0RGVmYXVsdChqb2luKF9fZGlybmFtZSwgJy4vY29uZmlnLnltbCcpKTtcblxuICAgIFNUT1JBR0UgPSBtYW5pcy5mcm9tKGZpbGVQYXRoKTtcblxuICAgIHJldHVybiBTVE9SQUdFO1xufVxuXG4vKipcbiAqIOa4heepuiBTVE9SQUdFXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjbGVhclN0b3JhZ2UoKSB7XG4gICAgU1RPUkFHRSA9IG51bGw7XG59XG4iXX0=