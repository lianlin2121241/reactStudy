'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.trim = trim;
exports.formatMsg = formatMsg;
exports.getCandidates = getCandidates;
exports.getIgnorePatterns = getIgnorePatterns;
exports.isIgnored = isIgnored;
exports.getLineContent = getLineContent;
exports.changeColorByIndex = changeColorByIndex;
exports.changeColorByStartAndEndIndex = changeColorByStartAndEndIndex;
exports.getPropertyValue = getPropertyValue;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _fs = require('fs');

var _edpCore = require('edp-core');

var _colors = require('./colors');

var _colors2 = _interopRequireDefault(_colors);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

'use strict'; /**
               * @file 通用方法
               * @author ielgnaw(wuji0223@gmail.com)
               */

var WHITESPACE = /^[\s\xa0\u3000]+|[\u3000\xa0\s]+$/g;

/**
 * 删除目标字符串两端的空白字符
 *
 * @param {string} source 目标字符串
 * @return {string} 删除两端空白字符后的字符串
 */
function trim(source) {
    if (!source) {
        return '';
    }

    return String(source).replace(WHITESPACE, '');
}

/**
 * 调用给定的迭代函数 n 次,每一次传递 index 参数，调用迭代函数。
 * from underscore
 *
 * @param {number} n 迭代次数
 * @param {Function} iterator 处理函数
 * @param {Object} context 上下文
 *
 * @return {Array} 结果
 */
function times(n, iterator, context) {
    var accum = new Array(Math.max(0, n));
    for (var i = 0; i < n; i++) {
        accum[i] = iterator.call(context, i);
    }
    return accum;
}

/**
 * 格式化信息
 *
 * @param {string} msg 输出的信息
 * @param {number} spaceCount 信息前面空格的个数即缩进的长度
 *
 * @return {string} 格式化后的信息
 */
function formatMsg(msg) {
    var spaceCount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

    var space = '';
    times(spaceCount, function () {
        space += ' ';
    });
    return space + msg;
}

/**
 * 根据参数以及模式匹配相应的文件
 *
 * @param {Array} args 文件
 * @param {Array} patterns minimatch 模式
 *
 * @return {Array.<string>} 匹配的文件集合
 */
function getCandidates(args, patterns) {
    var candidates = [];

    args = args.filter(function (item) {
        return item !== '.';
    });

    if (!args.length) {
        candidates = _edpCore.glob.sync(patterns);
    } else {
        var i = -1;
        var len = args.length;
        while (++i < len) {
            var target = args[i];
            if (!(0, _fs.existsSync)(target)) {
                _edpCore.log.warn('No such file or directory %s', target);
                continue;
            }

            var stat = (0, _fs.statSync)(target);
            if (stat.isDirectory()) {
                target = target.replace(/[\/|\\]+$/, '');
                candidates.push.apply(candidates, _edpCore.glob.sync(target + '/' + patterns[0]));
            }
            /* istanbul ignore else */
            else if (stat.isFile()) {
                    candidates.push(target);
                }
        }
    }

    return candidates;
}

/**
 * 获取忽略的 pattern
 *
 * @param {string} file 文件路径
 *
 * @return {Array.<string>} 结果
 */
function getIgnorePatterns(file) {
    if (!(0, _fs.existsSync)(file)) {
        return [];
    }

    var patterns = (0, _fs.readFileSync)(file, 'utf-8').split(/\r?\n/g);
    return patterns.filter(function (item) {
        return item.trim().length > 0 && item[0] !== '#';
    });
}

var _IGNORE_CACHE = {};

/**
 * 判断一下是否应该忽略这个文件.
 *
 * @param {string} file 需要检查的文件路径.
 * @param {string=} name ignore文件的名称.
 * @return {boolean}
 */
function isIgnored(file) {
    var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.csshintignore';

    var ignorePatterns = null;

    file = _edpCore.path.resolve(file);

    var key = name + '@' + _edpCore.path.dirname(file);
    if (_IGNORE_CACHE[key]) {
        ignorePatterns = _IGNORE_CACHE[key];
    } else {
        var options = {
            name: name,
            factory: function factory(item) {
                var config = {};
                getIgnorePatterns(item).forEach(function (line) {
                    config[line] = true;
                });
                return config;
            }
        };
        ignorePatterns = _edpCore.util.getConfig(_edpCore.path.dirname(file), options);

        _IGNORE_CACHE[key] = ignorePatterns;
    }

    var bizOrPkgRoot = process.cwd();

    try {
        bizOrPkgRoot = _edpCore.path.getRootDirectory();
    } catch (ex) {}

    var dirname = _edpCore.path.relative(bizOrPkgRoot, file);
    var isMatch = _edpCore.glob.match(dirname, Object.keys(ignorePatterns));

    return isMatch;
}

/**
 * 根据行号获取当前行的内容
 *
 * @param {number} line 行号
 * @param {string} fileData 文件内容
 * @param {boolean} isReplaceSpace 是否去掉空格
 *
 * @return {string} 当前行内容
 */
function getLineContent(line, fileData, isReplaceSpace) {
    var content = fileData.split('\n')[line - 1];
    if (isReplaceSpace) {
        content = content.replace(/\s*/, '');
    }
    return content;
}

/**
 * 根据索引把一行内容中的某个子串变色
 * 直接用正则匹配的话，可能会把这一行所有的 colorStr 给变色，所以要通过索引来判断
 *
 * @param {string} source 源字符串
 * @param {number} startIndex 开始的索引，通常是 col
 * @param {string} colorStr 要变色的字符串
 *
 * @return {string} 改变颜色后的字符串
 */
function changeColorByIndex(source, startIndex, colorStr) {
    var ret = '';
    if (source) {
        var colorStrLen = colorStr.length;
        var endIndex = startIndex + colorStrLen;
        ret = '' + source.slice(0, startIndex) // colorStr 前面的部分
        + _chalk2.default.magenta(source.slice(startIndex, endIndex)) // colorStr 的部分
        + source.slice(endIndex, source.length); // colorStr 后面的部分
    }
    return ret;
}

/**
 * 根据开始和结束的索引来高亮字符串的字串
 *
 * @param {string} source 源字符串
 * @param {number} startIndex 开始的索引
 * @param {number} endIndex 结束的索引
 *
 * @return {string} 改变颜色后的字符串
 */
function changeColorByStartAndEndIndex(source) {
    var startIndex = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var endIndex = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;

    if (!source) {
        return '';
    }

    startIndex -= 1;
    endIndex -= 1;

    return '' + source.slice(0, startIndex) // colorStr 前面的部分
    + _chalk2.default.magenta(source.slice(startIndex, endIndex)) // colorStr 的部分
    + source.slice(endIndex, source.length); // colorStr 后面的部分
}

/**
 * 获取 css 属性值的信息
 *
 * @param {string} text css 属性值
 *
 * @return {Array} 信息对象
 */
/* eslint-disable fecs-max-statements */
function getPropertyValue(text) {
    /* jshint maxstatements: 71, maxcomplexity: 43 */

    var parts = [];
    var arr = _postcss2.default.list.space(String(text));

    for (var i = 0, len = arr.length; i < len; i++) {
        var part = {
            text: arr[i]
        };

        var temp = void 0;

        // dimension
        if (/^([+\-]?[\d\.]+)([a-z]+)$/i.test(arr[i])) {
            part.value = +RegExp.$1;
            part.units = RegExp.$2;

            switch (part.units.toLowerCase()) {
                case 'em':
                case 'rem':
                case 'ex':
                case 'px':
                case 'cm':
                case 'mm':
                case 'in':
                case 'pt':
                case 'pc':
                case 'ch':
                case 'vh':
                case 'vw':
                case 'vmax':
                case 'vmin':
                    part.type = 'length';
                    break;

                case 'deg':
                case 'rad':
                case 'grad':
                    part.type = 'angle';
                    break;

                case 'ms':
                case 's':
                    part.type = 'time';
                    break;

                case 'hz':
                case 'khz':
                    part.type = 'frequency';
                    break;

                case 'dpi':
                case 'dpcm':
                    part.type = 'resolution';
                    break;

                default:
                    part.type = 'dimension';
            }
        }
        // percentage
        else if (/^([+\-]?[\d\.]+)%$/i.test(arr[i])) {
                part.type = 'percentage';
                part.value = +RegExp.$1;
            }
            // integer
            else if (/^([+\-]?\d+)$/i.test(arr[i])) {
                    part.type = 'integer';
                    part.value = +RegExp.$1;
                }
                // number
                else if (/^([+\-]?[\d\.]+)$/i.test(arr[i])) {
                        part.type = 'number';
                        part.value = +RegExp.$1;
                    }
                    // hexcolor
                    else if (/^#([a-f0-9]{3,6})/i.test(arr[i])) {
                            part.type = 'color';
                            temp = RegExp.$1;
                            if (temp.length === 3) {
                                part.red = parseInt(temp.charAt(0) + temp.charAt(0), 16);
                                part.green = parseInt(temp.charAt(1) + temp.charAt(1), 16);
                                part.blue = parseInt(temp.charAt(2) + temp.charAt(2), 16);
                            } else {
                                part.red = parseInt(temp.substring(0, 2), 16);
                                part.green = parseInt(temp.substring(2, 4), 16);
                                part.blue = parseInt(temp.substring(4, 6), 16);
                            }
                        }
                        // rgb() color with absolute numbers
                        else if (/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i.test(arr[i])) {
                                part.type = 'color';
                                part.red = +RegExp.$1;
                                part.green = +RegExp.$2;
                                part.blue = +RegExp.$3;
                            }
                            // rgb() color with percentages
                            else if (/^rgb\(\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)/i.test(arr[i])) {
                                    part.type = 'color';
                                    part.red = +RegExp.$1 * 255 / 100;
                                    part.green = +RegExp.$2 * 255 / 100;
                                    part.blue = +RegExp.$3 * 255 / 100;
                                }
                                // rgba() color with absolute numbers
                                else if (/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d\.]+)\s*\)/i.test(arr[i])) {
                                        part.type = 'color';
                                        part.red = +RegExp.$1;
                                        part.green = +RegExp.$2;
                                        part.blue = +RegExp.$3;
                                        part.alpha = +RegExp.$4;
                                    }
                                    // rgba() color with percentages
                                    else if (/^rgba\(\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*,\s*([\d\.]+)\s*\)/i.test(arr[i])) {
                                            part.type = 'color';
                                            part.red = +RegExp.$1 * 255 / 100;
                                            part.green = +RegExp.$2 * 255 / 100;
                                            part.blue = +RegExp.$3 * 255 / 100;
                                            part.alpha = +RegExp.$4;
                                        }
                                        // hsl()
                                        else if (/^hsl\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)/i.test(arr[i])) {
                                                part.type = 'color';
                                                part.hue = +RegExp.$1;
                                                part.saturation = +RegExp.$2 / 100;
                                                part.lightness = +RegExp.$3 / 100;
                                            }
                                            // hsla() color with percentages
                                            else if (/^hsla\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*,\s*([\d\.]+)\s*\)/i.test(arr[i])) {
                                                    part.type = 'color';
                                                    part.hue = +RegExp.$1;
                                                    part.saturation = +RegExp.$2 / 100;
                                                    part.lightness = +RegExp.$3 / 100;
                                                    part.alpha = +RegExp.$4;
                                                }
                                                // URI
                                                else if (/^url\(["']?([^\)"']+)["']?\)/i.test(arr[i])) {
                                                        part.type = 'uri';
                                                        part.uri = RegExp.$1;
                                                    } else if (/^([^\(]+)\(/i.test(arr[i])) {
                                                        part.type = 'function';
                                                        part.name = RegExp.$1;
                                                        part.value = arr[i];
                                                    }
                                                    // string
                                                    else if (/^["'][^"']*["']/.test(arr[i])) {
                                                            // eval('"Microsoft Yahei",') has error
                                                            temp = arr[i].replace(/,$/g, '');
                                                            part.type = 'string';
                                                            /* jshint evil: true */
                                                            /* eslint-disable fecs-no-eval, no-eval */
                                                            part.value = eval(temp);
                                                            /* eslint-enable fecs-no-eval, no-eval */
                                                        }
                                                        // named color
                                                        else if (_colors2.default[arr[i].toLowerCase()]) {
                                                                part.type = 'color';
                                                                temp = _colors2.default[arr[i].toLowerCase()].substring(1);
                                                                part.red = parseInt(temp.substring(0, 2), 16);
                                                                part.green = parseInt(temp.substring(2, 4), 16);
                                                                part.blue = parseInt(temp.substring(4, 6), 16);
                                                            } else if (/^[\,\/]$/.test(arr[i])) {
                                                                part.type = 'operator';
                                                                part.value = arr[i];
                                                            } else if (/^[a-z\-_\u0080-\uFFFF][a-z0-9\-_\u0080-\uFFFF]*$/i.test(arr[i])) {
                                                                part.type = 'identifier';
                                                                part.value = arr[i];
                                                            }

        parts.push(part);
    }

    return parts;
}
/* eslint-enable fecs-max-statements */
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlsLmpzIl0sIm5hbWVzIjpbInRyaW0iLCJmb3JtYXRNc2ciLCJnZXRDYW5kaWRhdGVzIiwiZ2V0SWdub3JlUGF0dGVybnMiLCJpc0lnbm9yZWQiLCJnZXRMaW5lQ29udGVudCIsImNoYW5nZUNvbG9yQnlJbmRleCIsImNoYW5nZUNvbG9yQnlTdGFydEFuZEVuZEluZGV4IiwiZ2V0UHJvcGVydHlWYWx1ZSIsIldISVRFU1BBQ0UiLCJzb3VyY2UiLCJTdHJpbmciLCJyZXBsYWNlIiwidGltZXMiLCJuIiwiaXRlcmF0b3IiLCJjb250ZXh0IiwiYWNjdW0iLCJBcnJheSIsIk1hdGgiLCJtYXgiLCJpIiwiY2FsbCIsIm1zZyIsInNwYWNlQ291bnQiLCJzcGFjZSIsImFyZ3MiLCJwYXR0ZXJucyIsImNhbmRpZGF0ZXMiLCJmaWx0ZXIiLCJpdGVtIiwibGVuZ3RoIiwic3luYyIsImxlbiIsInRhcmdldCIsIndhcm4iLCJzdGF0IiwiaXNEaXJlY3RvcnkiLCJwdXNoIiwiYXBwbHkiLCJpc0ZpbGUiLCJmaWxlIiwic3BsaXQiLCJfSUdOT1JFX0NBQ0hFIiwibmFtZSIsImlnbm9yZVBhdHRlcm5zIiwicmVzb2x2ZSIsImtleSIsImRpcm5hbWUiLCJvcHRpb25zIiwiZmFjdG9yeSIsImNvbmZpZyIsImZvckVhY2giLCJsaW5lIiwiZ2V0Q29uZmlnIiwiYml6T3JQa2dSb290IiwicHJvY2VzcyIsImN3ZCIsImdldFJvb3REaXJlY3RvcnkiLCJleCIsInJlbGF0aXZlIiwiaXNNYXRjaCIsIm1hdGNoIiwiT2JqZWN0Iiwia2V5cyIsImZpbGVEYXRhIiwiaXNSZXBsYWNlU3BhY2UiLCJjb250ZW50Iiwic3RhcnRJbmRleCIsImNvbG9yU3RyIiwicmV0IiwiY29sb3JTdHJMZW4iLCJlbmRJbmRleCIsInNsaWNlIiwibWFnZW50YSIsInRleHQiLCJwYXJ0cyIsImFyciIsImxpc3QiLCJwYXJ0IiwidGVtcCIsInRlc3QiLCJ2YWx1ZSIsIlJlZ0V4cCIsIiQxIiwidW5pdHMiLCIkMiIsInRvTG93ZXJDYXNlIiwidHlwZSIsInJlZCIsInBhcnNlSW50IiwiY2hhckF0IiwiZ3JlZW4iLCJibHVlIiwic3Vic3RyaW5nIiwiJDMiLCJhbHBoYSIsIiQ0IiwiaHVlIiwic2F0dXJhdGlvbiIsImxpZ2h0bmVzcyIsInVyaSIsImV2YWwiXSwibWFwcGluZ3MiOiI7Ozs7O1FBc0JnQkEsSSxHQUFBQSxJO1FBbUNBQyxTLEdBQUFBLFM7UUFnQkFDLGEsR0FBQUEsYTtRQTJDQUMsaUIsR0FBQUEsaUI7UUFrQkFDLFMsR0FBQUEsUztRQW1EQUMsYyxHQUFBQSxjO1FBa0JBQyxrQixHQUFBQSxrQjtRQXNCQUMsNkIsR0FBQUEsNkI7UUFzQkFDLGdCLEdBQUFBLGdCOztBQWxQaEI7Ozs7QUFDQTs7OztBQUNBOztBQUNBOztBQUVBOzs7Ozs7QUFFQSxhLENBWkE7Ozs7O0FBY0EsSUFBTUMsYUFBYSxvQ0FBbkI7O0FBRUE7Ozs7OztBQU1PLFNBQVNULElBQVQsQ0FBY1UsTUFBZCxFQUFzQjtBQUN6QixRQUFJLENBQUNBLE1BQUwsRUFBYTtBQUNULGVBQU8sRUFBUDtBQUNIOztBQUVELFdBQU9DLE9BQU9ELE1BQVAsRUFBZUUsT0FBZixDQUF1QkgsVUFBdkIsRUFBbUMsRUFBbkMsQ0FBUDtBQUNIOztBQUVEOzs7Ozs7Ozs7O0FBVUEsU0FBU0ksS0FBVCxDQUFlQyxDQUFmLEVBQWtCQyxRQUFsQixFQUE0QkMsT0FBNUIsRUFBcUM7QUFDakMsUUFBTUMsUUFBUSxJQUFJQyxLQUFKLENBQVVDLEtBQUtDLEdBQUwsQ0FBUyxDQUFULEVBQVlOLENBQVosQ0FBVixDQUFkO0FBQ0EsU0FBSyxJQUFJTyxJQUFJLENBQWIsRUFBZ0JBLElBQUlQLENBQXBCLEVBQXVCTyxHQUF2QixFQUE0QjtBQUN4QkosY0FBTUksQ0FBTixJQUFXTixTQUFTTyxJQUFULENBQWNOLE9BQWQsRUFBdUJLLENBQXZCLENBQVg7QUFDSDtBQUNELFdBQU9KLEtBQVA7QUFDSDs7QUFHRDs7Ozs7Ozs7QUFRTyxTQUFTaEIsU0FB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RUFBa0IsQ0FBbEIsQ0FBVCxFQUErQixFQUEvQixDQUFiO0FBQ0FmLHFFQUFLYyxJQUFMLEdBQVlILFNBQVNWLEtBQUtjLFNBQUwsQ0FBZSxDQUFmLEVBQWtCLENBQWxCLENBQVQsRUFBK0IsRUFBL0IsQ0FBWjtBQUNILDZEQU5JLE1BT0EsSUFBSSxXQUFXYixJQUFYLENBQWdCSixJQUFJeEQsQ0FBSixDQUFoQixDQUFKLEVBQTZCO0FBQzlCMEQscUVBQUtTLElBQUwsR0FBWSxVQUFaO0FBQ0FULHFFQUFLRyxLQUFMLEdBQWFMLElBQUl4RCxDQUFKLENBQWI7QUFDSCw2REFISSxNQUlBLElBQUksb0RBQW9ENEQsSUFBcEQsQ0FBeURKLElBQUl4RCxDQUFKLENBQXpELENBQUosRUFBc0U7QUFDdkUwRCxxRUFBS1MsSUFBTCxHQUFZLFlBQVo7QUFDQVQscUVBQUtHLEtBQUwsR0FBYUwsSUFBSXhELENBQUosQ0FBYjtBQUNIOztBQUVEdUQsY0FBTXRDLElBQU4sQ0FBV3lDLElBQVg7QUFDSDs7QUFFRCxXQUFPSCxLQUFQO0FBQ0g7QUFDRCIsImZpbGUiOiJ1dGlsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSDpgJrnlKjmlrnms5VcbiAqIEBhdXRob3IgaWVsZ25hdyh3dWppMDIyM0BnbWFpbC5jb20pXG4gKi9cblxuaW1wb3J0IGNoYWxrIGZyb20gJ2NoYWxrJztcbmltcG9ydCBwb3N0Y3NzIGZyb20gJ3Bvc3Rjc3MnO1xuaW1wb3J0IHtzdGF0U3luYywgZXhpc3RzU3luYywgcmVhZEZpbGVTeW5jfSBmcm9tICdmcyc7XG5pbXBvcnQge2dsb2IsIGxvZywgdXRpbCBhcyBlZHBVdGlsLCBwYXRoIGFzIGVkcFBhdGh9IGZyb20gJ2VkcC1jb3JlJztcblxuaW1wb3J0IGNvbG9ycyBmcm9tICcuL2NvbG9ycyc7XG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgV0hJVEVTUEFDRSA9IC9eW1xcc1xceGEwXFx1MzAwMF0rfFtcXHUzMDAwXFx4YTBcXHNdKyQvZztcblxuLyoqXG4gKiDliKDpmaTnm67moIflrZfnrKbkuLLkuKTnq6/nmoTnqbrnmb3lrZfnrKZcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc291cmNlIOebruagh+Wtl+espuS4slxuICogQHJldHVybiB7c3RyaW5nfSDliKDpmaTkuKTnq6/nqbrnmb3lrZfnrKblkI7nmoTlrZfnrKbkuLJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRyaW0oc291cmNlKSB7XG4gICAgaWYgKCFzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIHJldHVybiBTdHJpbmcoc291cmNlKS5yZXBsYWNlKFdISVRFU1BBQ0UsICcnKTtcbn1cblxuLyoqXG4gKiDosIPnlKjnu5nlrprnmoTov63ku6Plh73mlbAgbiDmrKEs5q+P5LiA5qyh5Lyg6YCSIGluZGV4IOWPguaVsO+8jOiwg+eUqOi/reS7o+WHveaVsOOAglxuICogZnJvbSB1bmRlcnNjb3JlXG4gKlxuICogQHBhcmFtIHtudW1iZXJ9IG4g6L+t5Luj5qyh5pWwXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRvciDlpITnkIblh73mlbBcbiAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0IOS4iuS4i+aWh1xuICpcbiAqIEByZXR1cm4ge0FycmF5fSDnu5PmnpxcbiAqL1xuZnVuY3Rpb24gdGltZXMobiwgaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICBjb25zdCBhY2N1bSA9IG5ldyBBcnJheShNYXRoLm1heCgwLCBuKSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgYWNjdW1baV0gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIGkpO1xuICAgIH1cbiAgICByZXR1cm4gYWNjdW07XG59XG5cblxuLyoqXG4gKiDmoLzlvI/ljJbkv6Hmga9cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbXNnIOi+k+WHuueahOS/oeaBr1xuICogQHBhcmFtIHtudW1iZXJ9IHNwYWNlQ291bnQg5L+h5oGv5YmN6Z2i56m65qC855qE5Liq5pWw5Y2z57yp6L+b55qE6ZW/5bqmXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSDmoLzlvI/ljJblkI7nmoTkv6Hmga9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdE1zZyhtc2csIHNwYWNlQ291bnQgPSAwKSB7XG4gICAgbGV0IHNwYWNlID0gJyc7XG4gICAgdGltZXMoc3BhY2VDb3VudCwgKCkgPT4ge1xuICAgICAgICBzcGFjZSArPSAnICc7XG4gICAgfSk7XG4gICAgcmV0dXJuIHNwYWNlICsgbXNnO1xufVxuXG4vKipcbiAqIOagueaNruWPguaVsOS7peWPiuaooeW8j+WMuemFjeebuOW6lOeahOaWh+S7tlxuICpcbiAqIEBwYXJhbSB7QXJyYXl9IGFyZ3Mg5paH5Lu2XG4gKiBAcGFyYW0ge0FycmF5fSBwYXR0ZXJucyBtaW5pbWF0Y2gg5qih5byPXG4gKlxuICogQHJldHVybiB7QXJyYXkuPHN0cmluZz59IOWMuemFjeeahOaWh+S7tumbhuWQiFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2FuZGlkYXRlcyhhcmdzLCBwYXR0ZXJucykge1xuICAgIGxldCBjYW5kaWRhdGVzID0gW107XG5cbiAgICBhcmdzID0gYXJncy5maWx0ZXIoaXRlbSA9PiBpdGVtICE9PSAnLicpO1xuXG4gICAgaWYgKCFhcmdzLmxlbmd0aCkge1xuICAgICAgICBjYW5kaWRhdGVzID0gZ2xvYi5zeW5jKHBhdHRlcm5zKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBpID0gLTE7XG4gICAgICAgIGxldCBsZW4gPSBhcmdzLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKCsraSA8IGxlbikge1xuICAgICAgICAgICAgbGV0IHRhcmdldCA9IGFyZ3NbaV07XG4gICAgICAgICAgICBpZiAoIWV4aXN0c1N5bmModGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIGxvZy53YXJuKCdObyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5ICVzJywgdGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHN0YXQgPSBzdGF0U3luYyh0YXJnZXQpO1xuICAgICAgICAgICAgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5yZXBsYWNlKC9bXFwvfFxcXFxdKyQvLCAnJyk7XG4gICAgICAgICAgICAgICAgY2FuZGlkYXRlcy5wdXNoLmFwcGx5KFxuICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGVzLFxuICAgICAgICAgICAgICAgICAgICBnbG9iLnN5bmModGFyZ2V0ICsgJy8nICsgcGF0dGVybnNbMF0pXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovXG4gICAgICAgICAgICBlbHNlIGlmIChzdGF0LmlzRmlsZSgpKSB7XG4gICAgICAgICAgICAgICAgY2FuZGlkYXRlcy5wdXNoKHRhcmdldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY2FuZGlkYXRlcztcbn1cblxuLyoqXG4gKiDojrflj5blv73nlaXnmoQgcGF0dGVyblxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlIOaWh+S7tui3r+W+hFxuICpcbiAqIEByZXR1cm4ge0FycmF5LjxzdHJpbmc+fSDnu5PmnpxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldElnbm9yZVBhdHRlcm5zKGZpbGUpIHtcbiAgICBpZiAoIWV4aXN0c1N5bmMoZmlsZSkpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGxldCBwYXR0ZXJucyA9IHJlYWRGaWxlU3luYyhmaWxlLCAndXRmLTgnKS5zcGxpdCgvXFxyP1xcbi9nKTtcbiAgICByZXR1cm4gcGF0dGVybnMuZmlsdGVyKGl0ZW0gPT4gaXRlbS50cmltKCkubGVuZ3RoID4gMCAmJiBpdGVtWzBdICE9PSAnIycpO1xufVxuXG5jb25zdCBfSUdOT1JFX0NBQ0hFID0ge307XG5cbi8qKlxuICog5Yik5pat5LiA5LiL5piv5ZCm5bqU6K+l5b+955Wl6L+Z5Liq5paH5Lu2LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlIOmcgOimgeajgOafpeeahOaWh+S7tui3r+W+hC5cbiAqIEBwYXJhbSB7c3RyaW5nPX0gbmFtZSBpZ25vcmXmlofku7bnmoTlkI3np7AuXG4gKiBAcmV0dXJuIHtib29sZWFufVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNJZ25vcmVkKGZpbGUsIG5hbWUgPSAnLmNzc2hpbnRpZ25vcmUnKSB7XG4gICAgbGV0IGlnbm9yZVBhdHRlcm5zID0gbnVsbDtcblxuICAgIGZpbGUgPSBlZHBQYXRoLnJlc29sdmUoZmlsZSk7XG5cbiAgICBsZXQga2V5ID0gbmFtZSArICdAJyAgKyBlZHBQYXRoLmRpcm5hbWUoZmlsZSk7XG4gICAgaWYgKF9JR05PUkVfQ0FDSEVba2V5XSkge1xuICAgICAgICBpZ25vcmVQYXR0ZXJucyA9IF9JR05PUkVfQ0FDSEVba2V5XTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgIGZhY3RvcnkoaXRlbSkge1xuICAgICAgICAgICAgICAgIGxldCBjb25maWcgPSB7fTtcbiAgICAgICAgICAgICAgICBnZXRJZ25vcmVQYXR0ZXJucyhpdGVtKS5mb3JFYWNoKGxpbmUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25maWdbbGluZV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlnbm9yZVBhdHRlcm5zID0gZWRwVXRpbC5nZXRDb25maWcoXG4gICAgICAgICAgICBlZHBQYXRoLmRpcm5hbWUoZmlsZSksXG4gICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICk7XG5cbiAgICAgICAgX0lHTk9SRV9DQUNIRVtrZXldID0gaWdub3JlUGF0dGVybnM7XG4gICAgfVxuXG4gICAgbGV0IGJpek9yUGtnUm9vdCA9IHByb2Nlc3MuY3dkKCk7XG5cbiAgICB0cnkge1xuICAgICAgICBiaXpPclBrZ1Jvb3QgPSBlZHBQYXRoLmdldFJvb3REaXJlY3RvcnkoKTtcbiAgICB9XG4gICAgY2F0Y2ggKGV4KSB7XG4gICAgfVxuXG4gICAgY29uc3QgZGlybmFtZSA9IGVkcFBhdGgucmVsYXRpdmUoYml6T3JQa2dSb290LCBmaWxlKTtcbiAgICBjb25zdCBpc01hdGNoID0gZ2xvYi5tYXRjaChkaXJuYW1lLCBPYmplY3Qua2V5cyhpZ25vcmVQYXR0ZXJucykpO1xuXG4gICAgcmV0dXJuIGlzTWF0Y2g7XG59XG5cbi8qKlxuICog5qC55o2u6KGM5Y+36I635Y+W5b2T5YmN6KGM55qE5YaF5a65XG4gKlxuICogQHBhcmFtIHtudW1iZXJ9IGxpbmUg6KGM5Y+3XG4gKiBAcGFyYW0ge3N0cmluZ30gZmlsZURhdGEg5paH5Lu25YaF5a65XG4gKiBAcGFyYW0ge2Jvb2xlYW59IGlzUmVwbGFjZVNwYWNlIOaYr+WQpuWOu+aOieepuuagvFxuICpcbiAqIEByZXR1cm4ge3N0cmluZ30g5b2T5YmN6KGM5YaF5a65XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRMaW5lQ29udGVudChsaW5lLCBmaWxlRGF0YSwgaXNSZXBsYWNlU3BhY2UpIHtcbiAgICBsZXQgY29udGVudCA9IGZpbGVEYXRhLnNwbGl0KCdcXG4nKVtsaW5lIC0gMV07XG4gICAgaWYgKGlzUmVwbGFjZVNwYWNlKSB7XG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoL1xccyovLCAnJyk7XG4gICAgfVxuICAgIHJldHVybiBjb250ZW50O1xufVxuXG4vKipcbiAqIOagueaNrue0ouW8leaKiuS4gOihjOWGheWuueS4reeahOafkOS4quWtkOS4suWPmOiJslxuICog55u05o6l55So5q2j5YiZ5Yy56YWN55qE6K+d77yM5Y+v6IO95Lya5oqK6L+Z5LiA6KGM5omA5pyJ55qEIGNvbG9yU3RyIOe7meWPmOiJsu+8jOaJgOS7peimgemAmui/h+e0ouW8leadpeWIpOaWrVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2Ug5rqQ5a2X56ym5LiyXG4gKiBAcGFyYW0ge251bWJlcn0gc3RhcnRJbmRleCDlvIDlp4vnmoTntKLlvJXvvIzpgJrluLjmmK8gY29sXG4gKiBAcGFyYW0ge3N0cmluZ30gY29sb3JTdHIg6KaB5Y+Y6Imy55qE5a2X56ym5LiyXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSDmlLnlj5jpopzoibLlkI7nmoTlrZfnrKbkuLJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNoYW5nZUNvbG9yQnlJbmRleChzb3VyY2UsIHN0YXJ0SW5kZXgsIGNvbG9yU3RyKSB7XG4gICAgbGV0IHJldCA9ICcnO1xuICAgIGlmIChzb3VyY2UpIHtcbiAgICAgICAgY29uc3QgY29sb3JTdHJMZW4gPSBjb2xvclN0ci5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGVuZEluZGV4ID0gc3RhcnRJbmRleCArIGNvbG9yU3RyTGVuO1xuICAgICAgICByZXQgPSAnJ1xuICAgICAgICAgICAgKyBzb3VyY2Uuc2xpY2UoMCwgc3RhcnRJbmRleCkgLy8gY29sb3JTdHIg5YmN6Z2i55qE6YOo5YiGXG4gICAgICAgICAgICArIGNoYWxrLm1hZ2VudGEoc291cmNlLnNsaWNlKHN0YXJ0SW5kZXgsIGVuZEluZGV4KSkgLy8gY29sb3JTdHIg55qE6YOo5YiGXG4gICAgICAgICAgICArIHNvdXJjZS5zbGljZShlbmRJbmRleCwgc291cmNlLmxlbmd0aCk7IC8vIGNvbG9yU3RyIOWQjumdoueahOmDqOWIhlxuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuXG4vKipcbiAqIOagueaNruW8gOWni+WSjOe7k+adn+eahOe0ouW8leadpemrmOS6ruWtl+espuS4sueahOWtl+S4slxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2Ug5rqQ5a2X56ym5LiyXG4gKiBAcGFyYW0ge251bWJlcn0gc3RhcnRJbmRleCDlvIDlp4vnmoTntKLlvJVcbiAqIEBwYXJhbSB7bnVtYmVyfSBlbmRJbmRleCDnu5PmnZ/nmoTntKLlvJVcbiAqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IOaUueWPmOminOiJsuWQjueahOWtl+espuS4slxuICovXG5leHBvcnQgZnVuY3Rpb24gY2hhbmdlQ29sb3JCeVN0YXJ0QW5kRW5kSW5kZXgoc291cmNlLCBzdGFydEluZGV4ID0gMCwgZW5kSW5kZXggPSAwKSB7XG4gICAgaWYgKCFzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIHN0YXJ0SW5kZXggLT0gMTtcbiAgICBlbmRJbmRleCAtPSAxO1xuXG4gICAgcmV0dXJuICcnXG4gICAgICAgICsgc291cmNlLnNsaWNlKDAsIHN0YXJ0SW5kZXgpIC8vIGNvbG9yU3RyIOWJjemdoueahOmDqOWIhlxuICAgICAgICArIGNoYWxrLm1hZ2VudGEoc291cmNlLnNsaWNlKHN0YXJ0SW5kZXgsIGVuZEluZGV4KSkgLy8gY29sb3JTdHIg55qE6YOo5YiGXG4gICAgICAgICsgc291cmNlLnNsaWNlKGVuZEluZGV4LCBzb3VyY2UubGVuZ3RoKTsgLy8gY29sb3JTdHIg5ZCO6Z2i55qE6YOo5YiGXG59XG5cbi8qKlxuICog6I635Y+WIGNzcyDlsZ7mgKflgLznmoTkv6Hmga9cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dCBjc3Mg5bGe5oCn5YC8XG4gKlxuICogQHJldHVybiB7QXJyYXl9IOS/oeaBr+WvueixoVxuICovXG4vKiBlc2xpbnQtZGlzYWJsZSBmZWNzLW1heC1zdGF0ZW1lbnRzICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHJvcGVydHlWYWx1ZSh0ZXh0KSB7XG4gICAgLyoganNoaW50IG1heHN0YXRlbWVudHM6IDcxLCBtYXhjb21wbGV4aXR5OiA0MyAqL1xuXG4gICAgY29uc3QgcGFydHMgPSBbXTtcbiAgICBjb25zdCBhcnIgPSBwb3N0Y3NzLmxpc3Quc3BhY2UoU3RyaW5nKHRleHQpKTtcblxuICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBhcnIubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgY29uc3QgcGFydCA9IHtcbiAgICAgICAgICAgIHRleHQ6IGFycltpXVxuICAgICAgICB9O1xuXG4gICAgICAgIGxldCB0ZW1wO1xuXG4gICAgICAgIC8vIGRpbWVuc2lvblxuICAgICAgICBpZiAoL14oWytcXC1dP1tcXGRcXC5dKykoW2Etel0rKSQvaS50ZXN0KGFycltpXSkpIHtcbiAgICAgICAgICAgIHBhcnQudmFsdWUgPSArUmVnRXhwLiQxO1xuICAgICAgICAgICAgcGFydC51bml0cyA9IFJlZ0V4cC4kMjtcblxuICAgICAgICAgICAgc3dpdGNoIChwYXJ0LnVuaXRzLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdlbSc6XG4gICAgICAgICAgICAgICAgY2FzZSAncmVtJzpcbiAgICAgICAgICAgICAgICBjYXNlICdleCc6XG4gICAgICAgICAgICAgICAgY2FzZSAncHgnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2NtJzpcbiAgICAgICAgICAgICAgICBjYXNlICdtbSc6XG4gICAgICAgICAgICAgICAgY2FzZSAnaW4nOlxuICAgICAgICAgICAgICAgIGNhc2UgJ3B0JzpcbiAgICAgICAgICAgICAgICBjYXNlICdwYyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnY2gnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ3ZoJzpcbiAgICAgICAgICAgICAgICBjYXNlICd2dyc6XG4gICAgICAgICAgICAgICAgY2FzZSAndm1heCc6XG4gICAgICAgICAgICAgICAgY2FzZSAndm1pbic6XG4gICAgICAgICAgICAgICAgICAgIHBhcnQudHlwZSA9ICdsZW5ndGgnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2RlZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAncmFkJzpcbiAgICAgICAgICAgICAgICBjYXNlICdncmFkJzpcbiAgICAgICAgICAgICAgICAgICAgcGFydC50eXBlID0gJ2FuZ2xlJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdtcyc6XG4gICAgICAgICAgICAgICAgY2FzZSAncyc6XG4gICAgICAgICAgICAgICAgICAgIHBhcnQudHlwZSA9ICd0aW1lJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdoeic6XG4gICAgICAgICAgICAgICAgY2FzZSAna2h6JzpcbiAgICAgICAgICAgICAgICAgICAgcGFydC50eXBlID0gJ2ZyZXF1ZW5jeSc7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnZHBpJzpcbiAgICAgICAgICAgICAgICBjYXNlICdkcGNtJzpcbiAgICAgICAgICAgICAgICAgICAgcGFydC50eXBlID0gJ3Jlc29sdXRpb24nO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHBhcnQudHlwZSA9ICdkaW1lbnNpb24nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHBlcmNlbnRhZ2VcbiAgICAgICAgZWxzZSBpZiAoL14oWytcXC1dP1tcXGRcXC5dKyklJC9pLnRlc3QoYXJyW2ldKSkge1xuICAgICAgICAgICAgcGFydC50eXBlID0gJ3BlcmNlbnRhZ2UnO1xuICAgICAgICAgICAgcGFydC52YWx1ZSA9ICtSZWdFeHAuJDE7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaW50ZWdlclxuICAgICAgICBlbHNlIGlmICgvXihbK1xcLV0/XFxkKykkL2kudGVzdChhcnJbaV0pKSB7XG4gICAgICAgICAgICBwYXJ0LnR5cGUgPSAnaW50ZWdlcic7XG4gICAgICAgICAgICBwYXJ0LnZhbHVlID0gK1JlZ0V4cC4kMTtcbiAgICAgICAgfVxuICAgICAgICAvLyBudW1iZXJcbiAgICAgICAgZWxzZSBpZiAoL14oWytcXC1dP1tcXGRcXC5dKykkL2kudGVzdChhcnJbaV0pKSB7XG4gICAgICAgICAgICBwYXJ0LnR5cGUgPSAnbnVtYmVyJztcbiAgICAgICAgICAgIHBhcnQudmFsdWUgPSArUmVnRXhwLiQxO1xuICAgICAgICB9XG4gICAgICAgIC8vIGhleGNvbG9yXG4gICAgICAgIGVsc2UgaWYgKC9eIyhbYS1mMC05XXszLDZ9KS9pLnRlc3QoYXJyW2ldKSkge1xuICAgICAgICAgICAgcGFydC50eXBlID0gJ2NvbG9yJztcbiAgICAgICAgICAgIHRlbXAgPSBSZWdFeHAuJDE7XG4gICAgICAgICAgICBpZiAodGVtcC5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgICAgICAgICBwYXJ0LnJlZCA9IHBhcnNlSW50KHRlbXAuY2hhckF0KDApICsgdGVtcC5jaGFyQXQoMCksIDE2KTtcbiAgICAgICAgICAgICAgICBwYXJ0LmdyZWVuID0gcGFyc2VJbnQodGVtcC5jaGFyQXQoMSkgKyB0ZW1wLmNoYXJBdCgxKSwgMTYpO1xuICAgICAgICAgICAgICAgIHBhcnQuYmx1ZSA9IHBhcnNlSW50KHRlbXAuY2hhckF0KDIpICsgdGVtcC5jaGFyQXQoMiksIDE2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhcnQucmVkID0gcGFyc2VJbnQodGVtcC5zdWJzdHJpbmcoMCwgMiksIDE2KTtcbiAgICAgICAgICAgICAgICBwYXJ0LmdyZWVuID0gcGFyc2VJbnQodGVtcC5zdWJzdHJpbmcoMiwgNCksIDE2KTtcbiAgICAgICAgICAgICAgICBwYXJ0LmJsdWUgPSBwYXJzZUludCh0ZW1wLnN1YnN0cmluZyg0LCA2KSwgMTYpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHJnYigpIGNvbG9yIHdpdGggYWJzb2x1dGUgbnVtYmVyc1xuICAgICAgICBlbHNlIGlmICgvXnJnYlxcKFxccyooXFxkKylcXHMqLFxccyooXFxkKylcXHMqLFxccyooXFxkKylcXHMqXFwpL2kudGVzdChhcnJbaV0pKSB7XG4gICAgICAgICAgICBwYXJ0LnR5cGUgPSAnY29sb3InO1xuICAgICAgICAgICAgcGFydC5yZWQgPSArUmVnRXhwLiQxO1xuICAgICAgICAgICAgcGFydC5ncmVlbiA9ICtSZWdFeHAuJDI7XG4gICAgICAgICAgICBwYXJ0LmJsdWUgPSArUmVnRXhwLiQzO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJnYigpIGNvbG9yIHdpdGggcGVyY2VudGFnZXNcbiAgICAgICAgZWxzZSBpZiAoL15yZ2JcXChcXHMqKFxcZCspJVxccyosXFxzKihcXGQrKSVcXHMqLFxccyooXFxkKyklXFxzKlxcKS9pLnRlc3QoYXJyW2ldKSkge1xuICAgICAgICAgICAgcGFydC50eXBlID0gJ2NvbG9yJztcbiAgICAgICAgICAgIHBhcnQucmVkID0gK1JlZ0V4cC4kMSAqIDI1NSAvIDEwMDtcbiAgICAgICAgICAgIHBhcnQuZ3JlZW4gPSArUmVnRXhwLiQyICogMjU1IC8gMTAwO1xuICAgICAgICAgICAgcGFydC5ibHVlID0gK1JlZ0V4cC4kMyAqIDI1NSAvIDEwMDtcbiAgICAgICAgfVxuICAgICAgICAvLyByZ2JhKCkgY29sb3Igd2l0aCBhYnNvbHV0ZSBudW1iZXJzXG4gICAgICAgIGVsc2UgaWYgKC9ecmdiYVxcKFxccyooXFxkKylcXHMqLFxccyooXFxkKylcXHMqLFxccyooXFxkKylcXHMqLFxccyooW1xcZFxcLl0rKVxccypcXCkvaS50ZXN0KGFycltpXSkpIHtcbiAgICAgICAgICAgIHBhcnQudHlwZSA9ICdjb2xvcic7XG4gICAgICAgICAgICBwYXJ0LnJlZCA9ICtSZWdFeHAuJDE7XG4gICAgICAgICAgICBwYXJ0LmdyZWVuID0gK1JlZ0V4cC4kMjtcbiAgICAgICAgICAgIHBhcnQuYmx1ZSA9ICtSZWdFeHAuJDM7XG4gICAgICAgICAgICBwYXJ0LmFscGhhID0gK1JlZ0V4cC4kNDtcbiAgICAgICAgfVxuICAgICAgICAvLyByZ2JhKCkgY29sb3Igd2l0aCBwZXJjZW50YWdlc1xuICAgICAgICBlbHNlIGlmICgvXnJnYmFcXChcXHMqKFxcZCspJVxccyosXFxzKihcXGQrKSVcXHMqLFxccyooXFxkKyklXFxzKixcXHMqKFtcXGRcXC5dKylcXHMqXFwpL2kudGVzdChhcnJbaV0pKSB7XG4gICAgICAgICAgICBwYXJ0LnR5cGUgPSAnY29sb3InO1xuICAgICAgICAgICAgcGFydC5yZWQgPSArUmVnRXhwLiQxICogMjU1IC8gMTAwO1xuICAgICAgICAgICAgcGFydC5ncmVlbiA9ICtSZWdFeHAuJDIgKiAyNTUgLyAxMDA7XG4gICAgICAgICAgICBwYXJ0LmJsdWUgPSArUmVnRXhwLiQzICogMjU1IC8gMTAwO1xuICAgICAgICAgICAgcGFydC5hbHBoYSA9ICtSZWdFeHAuJDQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaHNsKClcbiAgICAgICAgZWxzZSBpZiAoL15oc2xcXChcXHMqKFxcZCspXFxzKixcXHMqKFxcZCspJVxccyosXFxzKihcXGQrKSVcXHMqXFwpL2kudGVzdChhcnJbaV0pKSB7XG4gICAgICAgICAgICBwYXJ0LnR5cGUgPSAnY29sb3InO1xuICAgICAgICAgICAgcGFydC5odWUgPSArUmVnRXhwLiQxO1xuICAgICAgICAgICAgcGFydC5zYXR1cmF0aW9uID0gK1JlZ0V4cC4kMiAvIDEwMDtcbiAgICAgICAgICAgIHBhcnQubGlnaHRuZXNzID0gK1JlZ0V4cC4kMyAvIDEwMDtcbiAgICAgICAgfVxuICAgICAgICAvLyBoc2xhKCkgY29sb3Igd2l0aCBwZXJjZW50YWdlc1xuICAgICAgICBlbHNlIGlmICgvXmhzbGFcXChcXHMqKFxcZCspXFxzKixcXHMqKFxcZCspJVxccyosXFxzKihcXGQrKSVcXHMqLFxccyooW1xcZFxcLl0rKVxccypcXCkvaS50ZXN0KGFycltpXSkpIHtcbiAgICAgICAgICAgIHBhcnQudHlwZSA9ICdjb2xvcic7XG4gICAgICAgICAgICBwYXJ0Lmh1ZSAgPSArUmVnRXhwLiQxO1xuICAgICAgICAgICAgcGFydC5zYXR1cmF0aW9uID0gK1JlZ0V4cC4kMiAvIDEwMDtcbiAgICAgICAgICAgIHBhcnQubGlnaHRuZXNzID0gK1JlZ0V4cC4kMyAvIDEwMDtcbiAgICAgICAgICAgIHBhcnQuYWxwaGEgPSArUmVnRXhwLiQ0O1xuICAgICAgICB9XG4gICAgICAgIC8vIFVSSVxuICAgICAgICBlbHNlIGlmICgvXnVybFxcKFtcIiddPyhbXlxcKVwiJ10rKVtcIiddP1xcKS9pLnRlc3QoYXJyW2ldKSkge1xuICAgICAgICAgICAgcGFydC50eXBlID0gJ3VyaSc7XG4gICAgICAgICAgICBwYXJ0LnVyaSA9IFJlZ0V4cC4kMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgvXihbXlxcKF0rKVxcKC9pLnRlc3QoYXJyW2ldKSkge1xuICAgICAgICAgICAgcGFydC50eXBlID0gJ2Z1bmN0aW9uJztcbiAgICAgICAgICAgIHBhcnQubmFtZSA9IFJlZ0V4cC4kMTtcbiAgICAgICAgICAgIHBhcnQudmFsdWUgPSBhcnJbaV07XG4gICAgICAgIH1cbiAgICAgICAgLy8gc3RyaW5nXG4gICAgICAgIGVsc2UgaWYgKC9eW1wiJ11bXlwiJ10qW1wiJ10vLnRlc3QoYXJyW2ldKSkge1xuICAgICAgICAgICAgLy8gZXZhbCgnXCJNaWNyb3NvZnQgWWFoZWlcIiwnKSBoYXMgZXJyb3JcbiAgICAgICAgICAgIHRlbXAgPSBhcnJbaV0ucmVwbGFjZSgvLCQvZywgJycpO1xuICAgICAgICAgICAgcGFydC50eXBlID0gJ3N0cmluZyc7XG4gICAgICAgICAgICAvKiBqc2hpbnQgZXZpbDogdHJ1ZSAqL1xuICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgZmVjcy1uby1ldmFsLCBuby1ldmFsICovXG4gICAgICAgICAgICBwYXJ0LnZhbHVlID0gZXZhbCh0ZW1wKTtcbiAgICAgICAgICAgIC8qIGVzbGludC1lbmFibGUgZmVjcy1uby1ldmFsLCBuby1ldmFsICovXG4gICAgICAgIH1cbiAgICAgICAgLy8gbmFtZWQgY29sb3JcbiAgICAgICAgZWxzZSBpZiAoY29sb3JzW2FycltpXS50b0xvd2VyQ2FzZSgpXSkge1xuICAgICAgICAgICAgcGFydC50eXBlID0gJ2NvbG9yJztcbiAgICAgICAgICAgIHRlbXAgPSBjb2xvcnNbYXJyW2ldLnRvTG93ZXJDYXNlKCldLnN1YnN0cmluZygxKTtcbiAgICAgICAgICAgIHBhcnQucmVkICA9IHBhcnNlSW50KHRlbXAuc3Vic3RyaW5nKDAsIDIpLCAxNik7XG4gICAgICAgICAgICBwYXJ0LmdyZWVuID0gcGFyc2VJbnQodGVtcC5zdWJzdHJpbmcoMiwgNCksIDE2KTtcbiAgICAgICAgICAgIHBhcnQuYmx1ZSA9IHBhcnNlSW50KHRlbXAuc3Vic3RyaW5nKDQsIDYpLCAxNik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoL15bXFwsXFwvXSQvLnRlc3QoYXJyW2ldKSkge1xuICAgICAgICAgICAgcGFydC50eXBlID0gJ29wZXJhdG9yJztcbiAgICAgICAgICAgIHBhcnQudmFsdWUgPSBhcnJbaV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoL15bYS16XFwtX1xcdTAwODAtXFx1RkZGRl1bYS16MC05XFwtX1xcdTAwODAtXFx1RkZGRl0qJC9pLnRlc3QoYXJyW2ldKSkge1xuICAgICAgICAgICAgcGFydC50eXBlID0gJ2lkZW50aWZpZXInO1xuICAgICAgICAgICAgcGFydC52YWx1ZSA9IGFycltpXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHBhcnRzLnB1c2gocGFydCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcnRzO1xufVxuLyogZXNsaW50LWVuYWJsZSBmZWNzLW1heC1zdGF0ZW1lbnRzICovXG4iXX0=