'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.check = undefined;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _util = require('../util');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 当前文件所代表的规则名称
 *
 * @const
 * @type {string}
 */
var RULENAME = 'outline-none';

/**
 * 错误信息
 *
 * @const
 * @type {string}
 */
/**
 * @file outline-none 的检测逻辑
 *       Use of outline: none or outline: 0 should be limited to :focus rules
 *       https://github.com/CSSLint/csslint/wiki/Disallow-outline:none
 * @author ielgnaw(wuji0223@gmail.com)
 */

var MSG1 = 'Outlines should only be modified using :focus';

/**
 * 错误信息
 *
 * @const
 * @type {string}
 */
var MSG2 = 'Outlines shouldn\'t be hidden unless other visual changes are made';

var lastRule = void 0;

/**
 * 具体的检测逻辑
 *
 * @param {Object} opts 参数
 * @param {*} opts.ruleVal 当前规则具体配置的值
 * @param {string} opts.fileContent 文件内容
 * @param {string} opts.filePath 文件路径
 */
var check = exports.check = _postcss2.default.plugin(RULENAME, function (opts) {
    return function (css, result) {

        if (!opts.ruleVal) {
            return;
        }

        css.walkRules(function (rule) {
            if (global.CSSHINT_INVALID_ALL_COUNT >= opts.maxError) {
                return;
            }

            var selector = rule.selector;
            if (selector) {
                lastRule = {
                    rule: rule,
                    selector: selector,
                    propCount: 0,
                    outline: false
                };
            } else {
                lastRule = null;
            }

            rule.walkDecls(function (decl) {
                var prop = decl.prop,
                    value = decl.value;

                if (lastRule) {
                    lastRule.propCount++;
                    if (prop === 'outline' && (value === 'none' || value.toString() === '0')) {
                        lastRule.outline = true;
                    }
                }
            });

            if (lastRule) {
                if (lastRule.outline) {
                    var source = lastRule.rule.source;
                    var line = source.start.line;
                    var col = source.start.column;
                    var lineContent = (0, _util.getLineContent)(line, source.input.css);
                    if (lastRule.selector.toLowerCase().indexOf(':focus') === -1) {
                        result.warn(RULENAME, {
                            node: lastRule.rule,
                            ruleName: RULENAME,
                            line: line,
                            col: col,
                            message: MSG1,
                            colorMessage: '`' + lineContent.replace(selector, _chalk2.default.magenta(selector)) + '` ' + _chalk2.default.grey(MSG1)
                        });

                        global.CSSHINT_INVALID_ALL_COUNT++;
                    } else if (lastRule.propCount === 1) {
                        result.warn(RULENAME, {
                            node: lastRule.rule,
                            ruleName: RULENAME,
                            line: line,
                            col: col,
                            message: MSG2,
                            colorMessage: '`' + lineContent.replace(selector, _chalk2.default.magenta(selector)) + '` ' + _chalk2.default.grey(MSG2)
                        });

                        global.CSSHINT_INVALID_ALL_COUNT++;
                    }
                }
            }
        });
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ydWxlL291dGxpbmUtbm9uZS5qcyJdLCJuYW1lcyI6WyJSVUxFTkFNRSIsIk1TRzEiLCJNU0cyIiwibGFzdFJ1bGUiLCJjaGVjayIsInBsdWdpbiIsImNzcyIsInJlc3VsdCIsIm9wdHMiLCJydWxlVmFsIiwid2Fsa1J1bGVzIiwiZ2xvYmFsIiwiQ1NTSElOVF9JTlZBTElEX0FMTF9DT1VOVCIsIm1heEVycm9yIiwic2VsZWN0b3IiLCJydWxlIiwicHJvcENvdW50Iiwib3V0bGluZSIsIndhbGtEZWNscyIsInByb3AiLCJkZWNsIiwidmFsdWUiLCJ0b1N0cmluZyIsInNvdXJjZSIsImxpbmUiLCJzdGFydCIsImNvbCIsImNvbHVtbiIsImxpbmVDb250ZW50IiwiaW5wdXQiLCJ0b0xvd2VyQ2FzZSIsImluZGV4T2YiLCJ3YXJuIiwibm9kZSIsInJ1bGVOYW1lIiwibWVzc2FnZSIsImNvbG9yTWVzc2FnZSIsInJlcGxhY2UiLCJtYWdlbnRhIiwiZ3JleSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQU9BOzs7O0FBQ0E7Ozs7QUFFQTs7OztBQUVBOzs7Ozs7QUFNQSxJQUFNQSxXQUFXLGNBQWpCOztBQUVBOzs7Ozs7QUFwQkE7Ozs7Ozs7QUEwQkEsSUFBTUMsT0FBTywrQ0FBYjs7QUFFQTs7Ozs7O0FBTUEsSUFBTUMsT0FBTyxvRUFBYjs7QUFFQSxJQUFJQyxpQkFBSjs7QUFFQTs7Ozs7Ozs7QUFRTyxJQUFNQyx3QkFBUSxrQkFBUUMsTUFBUixDQUFlTCxRQUFmLEVBQXlCO0FBQUEsV0FDMUMsVUFBQ00sR0FBRCxFQUFNQyxNQUFOLEVBQWlCOztBQUViLFlBQUksQ0FBQ0MsS0FBS0MsT0FBVixFQUFtQjtBQUNmO0FBQ0g7O0FBRURILFlBQUlJLFNBQUosQ0FBYyxnQkFBUTtBQUNsQixnQkFBSUMsT0FBT0MseUJBQVAsSUFBb0NKLEtBQUtLLFFBQTdDLEVBQXVEO0FBQ25EO0FBQ0g7O0FBRUQsZ0JBQU1DLFdBQVdDLEtBQUtELFFBQXRCO0FBQ0EsZ0JBQUlBLFFBQUosRUFBYztBQUNWWCwyQkFBVztBQUNQWSwwQkFBTUEsSUFEQztBQUVQRCw4QkFBVUEsUUFGSDtBQUdQRSwrQkFBVyxDQUhKO0FBSVBDLDZCQUFTO0FBSkYsaUJBQVg7QUFNSCxhQVBELE1BUUs7QUFDRGQsMkJBQVcsSUFBWDtBQUNIOztBQUVEWSxpQkFBS0csU0FBTCxDQUFlLGdCQUFRO0FBQUEsb0JBQ1pDLElBRFksR0FDR0MsSUFESCxDQUNaRCxJQURZO0FBQUEsb0JBQ05FLEtBRE0sR0FDR0QsSUFESCxDQUNOQyxLQURNOztBQUVuQixvQkFBSWxCLFFBQUosRUFBYztBQUNWQSw2QkFBU2EsU0FBVDtBQUNBLHdCQUFJRyxTQUFTLFNBQVQsS0FBdUJFLFVBQVUsTUFBVixJQUFvQkEsTUFBTUMsUUFBTixPQUFxQixHQUFoRSxDQUFKLEVBQTBFO0FBQ3RFbkIsaUNBQVNjLE9BQVQsR0FBbUIsSUFBbkI7QUFDSDtBQUNKO0FBQ0osYUFSRDs7QUFVQSxnQkFBSWQsUUFBSixFQUFjO0FBQ1Ysb0JBQUlBLFNBQVNjLE9BQWIsRUFBc0I7QUFDbEIsd0JBQU1NLFNBQVNwQixTQUFTWSxJQUFULENBQWNRLE1BQTdCO0FBQ0Esd0JBQU1DLE9BQU9ELE9BQU9FLEtBQVAsQ0FBYUQsSUFBMUI7QUFDQSx3QkFBTUUsTUFBTUgsT0FBT0UsS0FBUCxDQUFhRSxNQUF6QjtBQUNBLHdCQUFNQyxjQUFjLDBCQUFlSixJQUFmLEVBQXFCRCxPQUFPTSxLQUFQLENBQWF2QixHQUFsQyxDQUFwQjtBQUNBLHdCQUFJSCxTQUFTVyxRQUFULENBQWtCZ0IsV0FBbEIsR0FBZ0NDLE9BQWhDLENBQXdDLFFBQXhDLE1BQXNELENBQUMsQ0FBM0QsRUFBOEQ7QUFDMUR4QiwrQkFBT3lCLElBQVAsQ0FBWWhDLFFBQVosRUFBc0I7QUFDbEJpQyxrQ0FBTTlCLFNBQVNZLElBREc7QUFFbEJtQixzQ0FBVWxDLFFBRlE7QUFHbEJ3QixrQ0FBTUEsSUFIWTtBQUlsQkUsaUNBQUtBLEdBSmE7QUFLbEJTLHFDQUFTbEMsSUFMUztBQU1sQm1DLDBDQUFjLE1BQ1JSLFlBQVlTLE9BQVosQ0FBb0J2QixRQUFwQixFQUE4QixnQkFBTXdCLE9BQU4sQ0FBY3hCLFFBQWQsQ0FBOUIsQ0FEUSxHQUVSLElBRlEsR0FHUixnQkFBTXlCLElBQU4sQ0FBV3RDLElBQVg7QUFUWSx5QkFBdEI7O0FBWUFVLCtCQUFPQyx5QkFBUDtBQUNILHFCQWRELE1BZUssSUFBSVQsU0FBU2EsU0FBVCxLQUF1QixDQUEzQixFQUE4QjtBQUMvQlQsK0JBQU95QixJQUFQLENBQVloQyxRQUFaLEVBQXNCO0FBQ2xCaUMsa0NBQU05QixTQUFTWSxJQURHO0FBRWxCbUIsc0NBQVVsQyxRQUZRO0FBR2xCd0Isa0NBQU1BLElBSFk7QUFJbEJFLGlDQUFLQSxHQUphO0FBS2xCUyxxQ0FBU2pDLElBTFM7QUFNbEJrQywwQ0FBYyxNQUNSUixZQUFZUyxPQUFaLENBQW9CdkIsUUFBcEIsRUFBOEIsZ0JBQU13QixPQUFOLENBQWN4QixRQUFkLENBQTlCLENBRFEsR0FFUixJQUZRLEdBR1IsZ0JBQU15QixJQUFOLENBQVdyQyxJQUFYO0FBVFkseUJBQXRCOztBQVlBUywrQkFBT0MseUJBQVA7QUFDSDtBQUNKO0FBQ0o7QUFDSixTQWxFRDtBQW1FSCxLQTFFeUM7QUFBQSxDQUF6QixDQUFkIiwiZmlsZSI6Im91dGxpbmUtbm9uZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgb3V0bGluZS1ub25lIOeahOajgOa1i+mAu+i+kVxuICogICAgICAgVXNlIG9mIG91dGxpbmU6IG5vbmUgb3Igb3V0bGluZTogMCBzaG91bGQgYmUgbGltaXRlZCB0byA6Zm9jdXMgcnVsZXNcbiAqICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9DU1NMaW50L2Nzc2xpbnQvd2lraS9EaXNhbGxvdy1vdXRsaW5lOm5vbmVcbiAqIEBhdXRob3IgaWVsZ25hdyh3dWppMDIyM0BnbWFpbC5jb20pXG4gKi9cblxuaW1wb3J0IGNoYWxrIGZyb20gJ2NoYWxrJztcbmltcG9ydCBwb3N0Y3NzIGZyb20gJ3Bvc3Rjc3MnO1xuXG5pbXBvcnQge2dldExpbmVDb250ZW50fSBmcm9tICcuLi91dGlsJztcblxuLyoqXG4gKiDlvZPliY3mlofku7bmiYDku6PooajnmoTop4TliJnlkI3np7BcbiAqXG4gKiBAY29uc3RcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmNvbnN0IFJVTEVOQU1FID0gJ291dGxpbmUtbm9uZSc7XG5cbi8qKlxuICog6ZSZ6K+v5L+h5oGvXG4gKlxuICogQGNvbnN0XG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5jb25zdCBNU0cxID0gJ091dGxpbmVzIHNob3VsZCBvbmx5IGJlIG1vZGlmaWVkIHVzaW5nIDpmb2N1cyc7XG5cbi8qKlxuICog6ZSZ6K+v5L+h5oGvXG4gKlxuICogQGNvbnN0XG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5jb25zdCBNU0cyID0gJ091dGxpbmVzIHNob3VsZG5cXCd0IGJlIGhpZGRlbiB1bmxlc3Mgb3RoZXIgdmlzdWFsIGNoYW5nZXMgYXJlIG1hZGUnO1xuXG5sZXQgbGFzdFJ1bGU7XG5cbi8qKlxuICog5YW35L2T55qE5qOA5rWL6YC76L6RXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMg5Y+C5pWwXG4gKiBAcGFyYW0geyp9IG9wdHMucnVsZVZhbCDlvZPliY3op4TliJnlhbfkvZPphY3nva7nmoTlgLxcbiAqIEBwYXJhbSB7c3RyaW5nfSBvcHRzLmZpbGVDb250ZW50IOaWh+S7tuWGheWuuVxuICogQHBhcmFtIHtzdHJpbmd9IG9wdHMuZmlsZVBhdGgg5paH5Lu26Lev5b6EXG4gKi9cbmV4cG9ydCBjb25zdCBjaGVjayA9IHBvc3Rjc3MucGx1Z2luKFJVTEVOQU1FLCBvcHRzID0+XG4gICAgKGNzcywgcmVzdWx0KSA9PiB7XG5cbiAgICAgICAgaWYgKCFvcHRzLnJ1bGVWYWwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNzcy53YWxrUnVsZXMocnVsZSA9PiB7XG4gICAgICAgICAgICBpZiAoZ2xvYmFsLkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQgPj0gb3B0cy5tYXhFcnJvcikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSBydWxlLnNlbGVjdG9yO1xuICAgICAgICAgICAgaWYgKHNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgICAgbGFzdFJ1bGUgPSB7XG4gICAgICAgICAgICAgICAgICAgIHJ1bGU6IHJ1bGUsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yOiBzZWxlY3RvcixcbiAgICAgICAgICAgICAgICAgICAgcHJvcENvdW50OiAwLFxuICAgICAgICAgICAgICAgICAgICBvdXRsaW5lOiBmYWxzZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsYXN0UnVsZSA9IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJ1bGUud2Fsa0RlY2xzKGRlY2wgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHtwcm9wLCB2YWx1ZX0gPSBkZWNsO1xuICAgICAgICAgICAgICAgIGlmIChsYXN0UnVsZSkge1xuICAgICAgICAgICAgICAgICAgICBsYXN0UnVsZS5wcm9wQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3AgPT09ICdvdXRsaW5lJyAmJiAodmFsdWUgPT09ICdub25lJyB8fCB2YWx1ZS50b1N0cmluZygpID09PSAnMCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0UnVsZS5vdXRsaW5lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAobGFzdFJ1bGUpIHtcbiAgICAgICAgICAgICAgICBpZiAobGFzdFJ1bGUub3V0bGluZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2UgPSBsYXN0UnVsZS5ydWxlLnNvdXJjZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGluZSA9IHNvdXJjZS5zdGFydC5saW5lO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSBzb3VyY2Uuc3RhcnQuY29sdW1uO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5lQ29udGVudCA9IGdldExpbmVDb250ZW50KGxpbmUsIHNvdXJjZS5pbnB1dC5jc3MpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobGFzdFJ1bGUuc2VsZWN0b3IudG9Mb3dlckNhc2UoKS5pbmRleE9mKCc6Zm9jdXMnKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC53YXJuKFJVTEVOQU1FLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogbGFzdFJ1bGUucnVsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlTmFtZTogUlVMRU5BTUUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbGluZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w6IGNvbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBNU0cxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yTWVzc2FnZTogJ2AnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgbGluZUNvbnRlbnQucmVwbGFjZShzZWxlY3RvciwgY2hhbGsubWFnZW50YShzZWxlY3RvcikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJ2AgJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGNoYWxrLmdyZXkoTVNHMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwuQ1NTSElOVF9JTlZBTElEX0FMTF9DT1VOVCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGxhc3RSdWxlLnByb3BDb3VudCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lndhcm4oUlVMRU5BTUUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlOiBsYXN0UnVsZS5ydWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGVOYW1lOiBSVUxFTkFNRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBsaW5lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IE1TRzIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JNZXNzYWdlOiAnYCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBsaW5lQ29udGVudC5yZXBsYWNlKHNlbGVjdG9yLCBjaGFsay5tYWdlbnRhKHNlbGVjdG9yKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnYCAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgY2hhbGsuZ3JleShNU0cyKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbC5DU1NISU5UX0lOVkFMSURfQUxMX0NPVU5UKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbik7XG4iXX0=