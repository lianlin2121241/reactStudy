'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.check = undefined;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _util = require('../util');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 当前文件所代表的规则名称
 *
 * @const
 * @type {string}
 */
var RULENAME = 'unifying-color-case-sensitive';

/**
 * 错误的信息
 *
 * @const
 * @type {string}
 */
/**
 * @file unifying-color-case-sensitive 的检测逻辑
 *       032: [建议] 颜色值中的英文字符采用小写。如不用小写也需要保证同一项目内保持大小写一致。
 * @author ielgnaw(wuji0223@gmail.com)
 */

var MSG = '' + 'The color value of the small English character. ' + 'If no lower case also need to ensure that the same project to keep the same case';

/**
 * 具体的检测逻辑
 *
 * @param {Object} opts 参数
 * @param {*} opts.ruleVal 当前规则具体配置的值
 * @param {string} opts.fileContent 文件内容
 * @param {string} opts.filePath 文件路径
 */
var check = exports.check = _postcss2.default.plugin(RULENAME, function (opts) {
    return function (css, result) {

        if (opts.ruleVal) {
            (function () {

                var source = void 0;
                var line = void 0;
                var lineContent = void 0;
                var col = void 0;

                css.walkDecls(function (decl) {
                    /* jshint maxstatements: 42, maxcomplexity: 12 */
                    if (global.CSSHINT_INVALID_ALL_COUNT >= opts.maxError) {
                        return;
                    }

                    var value = decl.value;

                    if (!/#([a-fA-Z0-9]{3,6})/.test(value) // 排除非 hexColor
                    || /^#([0-9]{6})/.test(value) // 排除 #000000 纯数字的情况
                    ) {
                            return;
                        }

                    var simpleColorStr = RegExp.$1;

                    // 当前这个颜色值里的字母全是小写 #fafafa
                    if (/^([a-z0-9]{3,6})$/.test(simpleColorStr)) {
                        if (global.CSSHINT_HEXCOLOR_CASE_FLAG === undefined) {
                            global.CSSHINT_HEXCOLOR_CASE_FLAG = 0;
                        }

                        // 说明之前已经检测过的颜色值里面的字母应该是大写
                        if (global.CSSHINT_HEXCOLOR_CASE_FLAG === 1) {
                            source = decl.source;
                            line = source.start.line;
                            lineContent = (0, _util.getLineContent)(line, source.input.css);
                            col = source.start.column + decl.prop.length + decl.raws.between.length;
                            var upperCaseMsg = MSG + ', Current project case is UpperCase.';
                            var upperCaseColorMsg = MSG + ', Current project case is ' + _chalk2.default.magenta('UpperCase.');

                            result.warn(RULENAME, {
                                node: decl,
                                ruleName: RULENAME,
                                line: line,
                                col: col,
                                message: upperCaseMsg,
                                colorMessage: '`' + (0, _util.changeColorByStartAndEndIndex)(lineContent, col, source.end.column) + '` ' + _chalk2.default.grey(upperCaseColorMsg)
                            });

                            global.CSSHINT_INVALID_ALL_COUNT++;
                        }
                    }
                    // 当前这个颜色值里面的字母全是大写 #FAFAFA
                    else if (/^([A-Z0-9]{3,6})$/.test(simpleColorStr)) {
                            if (global.CSSHINT_HEXCOLOR_CASE_FLAG === undefined) {
                                global.CSSHINT_HEXCOLOR_CASE_FLAG = 1;
                            }
                            // 说明之前已经检测过的颜色值里面的字母应该是大写
                            if (global.CSSHINT_HEXCOLOR_CASE_FLAG === 0) {
                                source = decl.source;
                                line = source.start.line;
                                lineContent = (0, _util.getLineContent)(line, source.input.css);
                                col = source.start.column + decl.prop.length + decl.raws.between.length;
                                var lowerCaseMsg = MSG + ', Current project case is LowerCase.';
                                var lowerCaseColorMsg = MSG + ', Current project case is ' + _chalk2.default.magenta('LowerCase.');

                                result.warn(RULENAME, {
                                    node: decl,
                                    ruleName: RULENAME,
                                    line: line,
                                    col: col,
                                    message: lowerCaseMsg,
                                    colorMessage: '`' + (0, _util.changeColorByStartAndEndIndex)(lineContent, col, source.end.column) + '` ' + _chalk2.default.grey(lowerCaseColorMsg)
                                });

                                global.CSSHINT_INVALID_ALL_COUNT++;
                            }
                        }
                        // 当前这个颜色值里面的字母有大写也有小写 #faFafA
                        else {
                                var str = MSG;
                                var colorStr = MSG;
                                if (global.CSSHINT_HEXCOLOR_CASE_FLAG === 0) {
                                    str += ', Current project case is LowerCase.';
                                    colorStr += ', Current project case is ' + _chalk2.default.magenta('LowerCase.');
                                } else if (global.CSSHINT_HEXCOLOR_CASE_FLAG === 1) {
                                    str += ', Current project case is UpperCase.';
                                    colorStr += ', Current project case is ' + _chalk2.default.magenta('UpperCase.');
                                }
                                source = decl.source;
                                line = source.start.line;
                                lineContent = (0, _util.getLineContent)(line, source.input.css);
                                col = source.start.column + decl.prop.length + decl.raws.between.length;

                                result.warn(RULENAME, {
                                    node: decl,
                                    ruleName: RULENAME,
                                    line: line,
                                    col: col,
                                    message: str,
                                    colorMessage: '`' + (0, _util.changeColorByStartAndEndIndex)(lineContent, col, source.end.column) + '` ' + _chalk2.default.grey(colorStr)
                                });

                                global.CSSHINT_INVALID_ALL_COUNT++;
                            }
                });
            })();
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ydWxlL3VuaWZ5aW5nLWNvbG9yLWNhc2Utc2Vuc2l0aXZlLmpzIl0sIm5hbWVzIjpbIlJVTEVOQU1FIiwiTVNHIiwiY2hlY2siLCJwbHVnaW4iLCJjc3MiLCJyZXN1bHQiLCJvcHRzIiwicnVsZVZhbCIsInNvdXJjZSIsImxpbmUiLCJsaW5lQ29udGVudCIsImNvbCIsIndhbGtEZWNscyIsImdsb2JhbCIsIkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQiLCJtYXhFcnJvciIsInZhbHVlIiwiZGVjbCIsInRlc3QiLCJzaW1wbGVDb2xvclN0ciIsIlJlZ0V4cCIsIiQxIiwiQ1NTSElOVF9IRVhDT0xPUl9DQVNFX0ZMQUciLCJ1bmRlZmluZWQiLCJzdGFydCIsImlucHV0IiwiY29sdW1uIiwicHJvcCIsImxlbmd0aCIsInJhd3MiLCJiZXR3ZWVuIiwidXBwZXJDYXNlTXNnIiwidXBwZXJDYXNlQ29sb3JNc2ciLCJtYWdlbnRhIiwid2FybiIsIm5vZGUiLCJydWxlTmFtZSIsIm1lc3NhZ2UiLCJjb2xvck1lc3NhZ2UiLCJlbmQiLCJncmV5IiwibG93ZXJDYXNlTXNnIiwibG93ZXJDYXNlQ29sb3JNc2ciLCJzdHIiLCJjb2xvclN0ciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQU1BOzs7O0FBQ0E7Ozs7QUFFQTs7OztBQUVBOzs7Ozs7QUFNQSxJQUFNQSxXQUFXLCtCQUFqQjs7QUFFQTs7Ozs7O0FBbkJBOzs7Ozs7QUF5QkEsSUFBTUMsTUFBTSxLQUNOLGtEQURNLEdBRU4sa0ZBRk47O0FBSUE7Ozs7Ozs7O0FBUU8sSUFBTUMsd0JBQVEsa0JBQVFDLE1BQVIsQ0FBZUgsUUFBZixFQUF5QjtBQUFBLFdBQzFDLFVBQUNJLEdBQUQsRUFBTUMsTUFBTixFQUFpQjs7QUFFYixZQUFJQyxLQUFLQyxPQUFULEVBQWtCO0FBQUE7O0FBRWQsb0JBQUlDLGVBQUo7QUFDQSxvQkFBSUMsYUFBSjtBQUNBLG9CQUFJQyxvQkFBSjtBQUNBLG9CQUFJQyxZQUFKOztB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QVg7QUFYWSxpQ0FBdEI7O0FBY0EvQix1Q0FBT0MseUJBQVA7QUFDSDtBQUNKLGlCQWhIRDtBQVBjO0FBd0hqQjtBQUNKLEtBNUh5QztBQUFBLENBQXpCLENBQWQiLCJmaWxlIjoidW5pZnlpbmctY29sb3ItY2FzZS1zZW5zaXRpdmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIHVuaWZ5aW5nLWNvbG9yLWNhc2Utc2Vuc2l0aXZlIOeahOajgOa1i+mAu+i+kVxuICogICAgICAgMDMyOiBb5bu66K6uXSDpopzoibLlgLzkuK3nmoToi7HmloflrZfnrKbph4fnlKjlsI/lhpnjgILlpoLkuI3nlKjlsI/lhpnkuZ/pnIDopoHkv53or4HlkIzkuIDpobnnm67lhoXkv53mjIHlpKflsI/lhpnkuIDoh7TjgIJcbiAqIEBhdXRob3IgaWVsZ25hdyh3dWppMDIyM0BnbWFpbC5jb20pXG4gKi9cblxuaW1wb3J0IGNoYWxrIGZyb20gJ2NoYWxrJztcbmltcG9ydCBwb3N0Y3NzIGZyb20gJ3Bvc3Rjc3MnO1xuXG5pbXBvcnQge2dldExpbmVDb250ZW50LCBjaGFuZ2VDb2xvckJ5U3RhcnRBbmRFbmRJbmRleH0gZnJvbSAnLi4vdXRpbCc7XG5cbi8qKlxuICog5b2T5YmN5paH5Lu25omA5Luj6KGo55qE6KeE5YiZ5ZCN56ewXG4gKlxuICogQGNvbnN0XG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5jb25zdCBSVUxFTkFNRSA9ICd1bmlmeWluZy1jb2xvci1jYXNlLXNlbnNpdGl2ZSc7XG5cbi8qKlxuICog6ZSZ6K+v55qE5L+h5oGvXG4gKlxuICogQGNvbnN0XG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5jb25zdCBNU0cgPSAnJ1xuICAgICsgJ1RoZSBjb2xvciB2YWx1ZSBvZiB0aGUgc21hbGwgRW5nbGlzaCBjaGFyYWN0ZXIuICdcbiAgICArICdJZiBubyBsb3dlciBjYXNlIGFsc28gbmVlZCB0byBlbnN1cmUgdGhhdCB0aGUgc2FtZSBwcm9qZWN0IHRvIGtlZXAgdGhlIHNhbWUgY2FzZSc7XG5cbi8qKlxuICog5YW35L2T55qE5qOA5rWL6YC76L6RXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMg5Y+C5pWwXG4gKiBAcGFyYW0geyp9IG9wdHMucnVsZVZhbCDlvZPliY3op4TliJnlhbfkvZPphY3nva7nmoTlgLxcbiAqIEBwYXJhbSB7c3RyaW5nfSBvcHRzLmZpbGVDb250ZW50IOaWh+S7tuWGheWuuVxuICogQHBhcmFtIHtzdHJpbmd9IG9wdHMuZmlsZVBhdGgg5paH5Lu26Lev5b6EXG4gKi9cbmV4cG9ydCBjb25zdCBjaGVjayA9IHBvc3Rjc3MucGx1Z2luKFJVTEVOQU1FLCBvcHRzID0+XG4gICAgKGNzcywgcmVzdWx0KSA9PiB7XG5cbiAgICAgICAgaWYgKG9wdHMucnVsZVZhbCkge1xuXG4gICAgICAgICAgICBsZXQgc291cmNlO1xuICAgICAgICAgICAgbGV0IGxpbmU7XG4gICAgICAgICAgICBsZXQgbGluZUNvbnRlbnQ7XG4gICAgICAgICAgICBsZXQgY29sO1xuXG4gICAgICAgICAgICBjc3Mud2Fsa0RlY2xzKGRlY2wgPT4ge1xuICAgICAgICAgICAgICAgIC8qIGpzaGludCBtYXhzdGF0ZW1lbnRzOiA0MiwgbWF4Y29tcGxleGl0eTogMTIgKi9cbiAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsLkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQgPj0gb3B0cy5tYXhFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBkZWNsLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgaWYgKCEvIyhbYS1mQS1aMC05XXszLDZ9KS8udGVzdCh2YWx1ZSkgLy8g5o6S6Zmk6Z2eIGhleENvbG9yXG4gICAgICAgICAgICAgICAgICAgIHx8IC9eIyhbMC05XXs2fSkvLnRlc3QodmFsdWUpIC8vIOaOkumZpCAjMDAwMDAwIOe6r+aVsOWtl+eahOaDheWGtVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3Qgc2ltcGxlQ29sb3JTdHIgPSBSZWdFeHAuJDE7XG5cbiAgICAgICAgICAgICAgICAvLyDlvZPliY3ov5nkuKrpopzoibLlgLzph4znmoTlrZfmr43lhajmmK/lsI/lhpkgI2ZhZmFmYVxuICAgICAgICAgICAgICAgIGlmICgvXihbYS16MC05XXszLDZ9KSQvLnRlc3Qoc2ltcGxlQ29sb3JTdHIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChnbG9iYWwuQ1NTSElOVF9IRVhDT0xPUl9DQVNFX0ZMQUcgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLkNTU0hJTlRfSEVYQ09MT1JfQ0FTRV9GTEFHID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIOivtOaYjuS5i+WJjeW3sue7j+ajgOa1i+i/h+eahOminOiJsuWAvOmHjOmdoueahOWtl+avjeW6lOivpeaYr+Wkp+WGmVxuICAgICAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsLkNTU0hJTlRfSEVYQ09MT1JfQ0FTRV9GTEFHID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2UgPSBkZWNsLnNvdXJjZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSBzb3VyY2Uuc3RhcnQubGluZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVDb250ZW50ID0gZ2V0TGluZUNvbnRlbnQobGluZSwgc291cmNlLmlucHV0LmNzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSBzb3VyY2Uuc3RhcnQuY29sdW1uICsgZGVjbC5wcm9wLmxlbmd0aCArIGRlY2wucmF3cy5iZXR3ZWVuLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwcGVyQ2FzZU1zZyA9ICBNU0cgKyAnLCBDdXJyZW50IHByb2plY3QgY2FzZSBpcyBVcHBlckNhc2UuJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwcGVyQ2FzZUNvbG9yTXNnID0gIE1TRyArICcsIEN1cnJlbnQgcHJvamVjdCBjYXNlIGlzICcgKyBjaGFsay5tYWdlbnRhKCdVcHBlckNhc2UuJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC53YXJuKFJVTEVOQU1FLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogZGVjbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlTmFtZTogUlVMRU5BTUUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbGluZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w6IGNvbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiB1cHBlckNhc2VNc2csXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JNZXNzYWdlOiAnYCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjaGFuZ2VDb2xvckJ5U3RhcnRBbmRFbmRJbmRleChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVDb250ZW50LCBjb2wsIHNvdXJjZS5lbmQuY29sdW1uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnYCAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgY2hhbGsuZ3JleSh1cHBlckNhc2VDb2xvck1zZylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwuQ1NTSElOVF9JTlZBTElEX0FMTF9DT1VOVCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIOW9k+WJjei/meS4quminOiJsuWAvOmHjOmdoueahOWtl+avjeWFqOaYr+Wkp+WGmSAjRkFGQUZBXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoL14oW0EtWjAtOV17Myw2fSkkLy50ZXN0KHNpbXBsZUNvbG9yU3RyKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsLkNTU0hJTlRfSEVYQ09MT1JfQ0FTRV9GTEFHID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbC5DU1NISU5UX0hFWENPTE9SX0NBU0VfRkxBRyA9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8g6K+05piO5LmL5YmN5bey57uP5qOA5rWL6L+H55qE6aKc6Imy5YC86YeM6Z2i55qE5a2X5q+N5bqU6K+l5piv5aSn5YaZXG4gICAgICAgICAgICAgICAgICAgIGlmIChnbG9iYWwuQ1NTSElOVF9IRVhDT0xPUl9DQVNFX0ZMQUcgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZSA9IGRlY2wuc291cmNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IHNvdXJjZS5zdGFydC5saW5lO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZUNvbnRlbnQgPSBnZXRMaW5lQ29udGVudChsaW5lLCBzb3VyY2UuaW5wdXQuY3NzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IHNvdXJjZS5zdGFydC5jb2x1bW4gKyBkZWNsLnByb3AubGVuZ3RoICsgZGVjbC5yYXdzLmJldHdlZW4ubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG93ZXJDYXNlTXNnID0gIE1TRyArICcsIEN1cnJlbnQgcHJvamVjdCBjYXNlIGlzIExvd2VyQ2FzZS4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG93ZXJDYXNlQ29sb3JNc2cgPSAgTVNHICsgJywgQ3VycmVudCBwcm9qZWN0IGNhc2UgaXMgJyArIGNoYWxrLm1hZ2VudGEoJ0xvd2VyQ2FzZS4nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lndhcm4oUlVMRU5BTUUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlOiBkZWNsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGVOYW1lOiBSVUxFTkFNRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBsaW5lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGxvd2VyQ2FzZU1zZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvck1lc3NhZ2U6ICdgJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGNoYW5nZUNvbG9yQnlTdGFydEFuZEVuZEluZGV4KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUNvbnRlbnQsIGNvbCwgc291cmNlLmVuZC5jb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICdgICdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjaGFsay5ncmV5KGxvd2VyQ2FzZUNvbG9yTXNnKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbC5DU1NISU5UX0lOVkFMSURfQUxMX0NPVU5UKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8g5b2T5YmN6L+Z5Liq6aKc6Imy5YC86YeM6Z2i55qE5a2X5q+N5pyJ5aSn5YaZ5Lmf5pyJ5bCP5YaZICNmYUZhZkFcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0ciA9IE1TRztcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbG9yU3RyID0gTVNHO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsLkNTU0hJTlRfSEVYQ09MT1JfQ0FTRV9GTEFHID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJywgQ3VycmVudCBwcm9qZWN0IGNhc2UgaXMgTG93ZXJDYXNlLic7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvclN0ciArPSAnLCBDdXJyZW50IHByb2plY3QgY2FzZSBpcyAnICsgY2hhbGsubWFnZW50YSgnTG93ZXJDYXNlLicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGdsb2JhbC5DU1NISU5UX0hFWENPTE9SX0NBU0VfRkxBRyA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9ICcsIEN1cnJlbnQgcHJvamVjdCBjYXNlIGlzIFVwcGVyQ2FzZS4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JTdHIgKz0gJywgQ3VycmVudCBwcm9qZWN0IGNhc2UgaXMgJyArIGNoYWxrLm1hZ2VudGEoJ1VwcGVyQ2FzZS4nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzb3VyY2UgPSBkZWNsLnNvdXJjZTtcbiAgICAgICAgICAgICAgICAgICAgbGluZSA9IHNvdXJjZS5zdGFydC5saW5lO1xuICAgICAgICAgICAgICAgICAgICBsaW5lQ29udGVudCA9IGdldExpbmVDb250ZW50KGxpbmUsIHNvdXJjZS5pbnB1dC5jc3MpO1xuICAgICAgICAgICAgICAgICAgICBjb2wgPSBzb3VyY2Uuc3RhcnQuY29sdW1uICsgZGVjbC5wcm9wLmxlbmd0aCArIGRlY2wucmF3cy5iZXR3ZWVuLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgICAgICByZXN1bHQud2FybihSVUxFTkFNRSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogZGVjbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGVOYW1lOiBSVUxFTkFNRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IGxpbmUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2w6IGNvbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHN0cixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yTWVzc2FnZTogJ2AnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjaGFuZ2VDb2xvckJ5U3RhcnRBbmRFbmRJbmRleChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUNvbnRlbnQsIGNvbCwgc291cmNlLmVuZC5jb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnYCAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjaGFsay5ncmV5KGNvbG9yU3RyKVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBnbG9iYWwuQ1NTSElOVF9JTlZBTElEX0FMTF9DT1VOVCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuKTtcbiJdfQ==