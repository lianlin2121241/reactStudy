'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.check = undefined;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _util = require('../util');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 当前文件所代表的规则名称
 *
 * @const
 * @type {string}
 */
var RULENAME = 'unifying-font-family-case-sensitive';

/**
 * 错误的信息
 *
 * @const
 * @type {string}
 */
/**
 * @file unifying-font-family-case-sensitive 的检测逻辑
 *       036: [强制] `font-family` 不区分大小写，但在同一个项目中，同样的 `Family Name` 大小写必须统一。
 * @author ielgnaw(wuji0223@gmail.com)
 */

var MSG = '`font-family` case insensitive, but in the same project, the same` Family Name` case must be unified.';

/**
 * 获取错误信息
 *
 * @param {string} curFontFamily 当前检测的这个 font-family 值
 * @param {string} projFontFamily 项目级别对应的这个 font-family 值
 *
 * @return {Object} 错误信息
 */
var getMsg = function getMsg(curFontFamily, projFontFamily) {
    return {
        msg: MSG + ' In currently project, ' + '`' + curFontFamily + '` should be `' + projFontFamily + '`.',
        colorMsg: MSG + ' In currently project, ' + '`' + _chalk2.default.magenta(curFontFamily) + '` should be `' + _chalk2.default.magenta(projFontFamily) + '`.'
    };
};

/**
 * 具体的检测逻辑
 *
 * @param {Object} opts 参数
 * @param {*} opts.ruleVal 当前规则具体配置的值
 * @param {string} opts.fileContent 文件内容
 * @param {string} opts.filePath 文件路径
 */
var check = exports.check = _postcss2.default.plugin(RULENAME, function (opts) {
    return function (css, result) {
        if (!opts.ruleVal) {
            return;
        }

        css.walkDecls(function (decl) {
            if (global.CSSHINT_INVALID_ALL_COUNT >= opts.maxError) {
                return;
            }

            var prop = decl.prop;

            if (prop === 'font-family') {
                var parts = _postcss2.default.list.space(decl.value);
                for (var i = 0, len = parts.length; i < len; i++) {
                    var part = parts[i].replace(/['",]/g, '');
                    var partLowerCase = part.toLowerCase();

                    if (!global.CSSHINT_FONTFAMILY_CASE_FLAG[partLowerCase]) {
                        global.CSSHINT_FONTFAMILY_CASE_FLAG[partLowerCase] = part;
                    } else {
                        if (global.CSSHINT_FONTFAMILY_CASE_FLAG[partLowerCase] !== part) {
                            var source = decl.source;
                            var line = source.start.line;
                            var lineContent = (0, _util.getLineContent)(line, source.input.css);
                            var col = lineContent.indexOf(part) + 1;

                            var m = getMsg(part, global.CSSHINT_FONTFAMILY_CASE_FLAG[partLowerCase]);

                            result.warn(RULENAME, {
                                node: decl,
                                ruleName: RULENAME,
                                line: line,
                                col: col,
                                message: m.msg,
                                colorMessage: '`' + lineContent.replace(part, _chalk2.default.magenta(part)) + '` ' + _chalk2.default.grey(m.colorMsg)
                            });
                            global.CSSHINT_INVALID_ALL_COUNT++;
                        }
                    }
                }
            }
        });
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ydWxlL3VuaWZ5aW5nLWZvbnQtZmFtaWx5LWNhc2Utc2Vuc2l0aXZlLmpzIl0sIm5hbWVzIjpbIlJVTEVOQU1FIiwiTVNHIiwiZ2V0TXNnIiwiY3VyRm9udEZhbWlseSIsInByb2pGb250RmFtaWx5IiwibXNnIiwiY29sb3JNc2ciLCJtYWdlbnRhIiwiY2hlY2siLCJwbHVnaW4iLCJjc3MiLCJyZXN1bHQiLCJvcHRzIiwicnVsZVZhbCIsIndhbGtEZWNscyIsImdsb2JhbCIsIkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQiLCJtYXhFcnJvciIsInByb3AiLCJkZWNsIiwicGFydHMiLCJsaXN0Iiwic3BhY2UiLCJ2YWx1ZSIsImkiLCJsZW4iLCJsZW5ndGgiLCJwYXJ0IiwicmVwbGFjZSIsInBhcnRMb3dlckNhc2UiLCJ0b0xvd2VyQ2FzZSIsIkNTU0hJTlRfRk9OVEZBTUlMWV9DQVNFX0ZMQUciLCJzb3VyY2UiLCJsaW5lIiwic3RhcnQiLCJsaW5lQ29udGVudCIsImlucHV0IiwiY29sIiwiaW5kZXhPZiIsIm0iLCJ3YXJuIiwibm9kZSIsInJ1bGVOYW1lIiwibWVzc2FnZSIsImNvbG9yTWVzc2FnZSIsImdyZXkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFNQTs7OztBQUNBOzs7O0FBRUE7Ozs7QUFFQTs7Ozs7O0FBTUEsSUFBTUEsV0FBVyxxQ0FBakI7O0FBRUE7Ozs7OztBQW5CQTs7Ozs7O0FBeUJBLElBQU1DLE1BQU0sdUdBQVo7O0FBRUE7Ozs7Ozs7O0FBUUEsSUFBTUMsU0FBUyxTQUFUQSxNQUFTLENBQUNDLGFBQUQsRUFBZ0JDLGNBQWhCLEVBQW1DO0FBQzlDLFdBQU87QUFDSEMsYUFBS0osTUFDQyx5QkFERCxHQUVDLEdBRkQsR0FHQ0UsYUFIRCxHQUlDLGVBSkQsR0FLR0MsY0FMSCxHQU1DLElBUEg7QUFRSEUsa0JBQVVMLE1BQ0oseUJBREksR0FFSixHQUZJLEdBR0osZ0JBQU1NLE9BQU4sQ0FBY0osYUFBZCxDQUhJLEdBSUosZUFKSSxHQUtKLGdCQUFNSSxPQUFOLENBQWNILGNBQWQsQ0FMSSxHQU1KO0FBZEgsS0FBUDtBQWdCSCxDQWpCRDs7QUFtQkE7Ozs7Ozs7O0FBUU8sSUFBTUksd0JBQVEsa0JBQVFDLE1BQVIsQ0FBZVQsUUFBZixFQUF5QjtBQUFBLFdBQzFDLFVBQUNVLEdBQUQsRUFBTUMsTUFBTixFQUFpQjtBQUNiLFlBQUksQ0FBQ0MsS0FBS0MsT0FBVixFQUFtQjtBQUNmO0FBQ0g7O0FBRURILFlBQUlJLFNBQUosQ0FBYyxnQkFBUTtBQUNsQixnQkFBSUMsT0FBT0MseUJBQVAsSUFBb0NKLEtBQUtLLFFBQTdDLEVBQXVEO0FBQ25EO0FBQ0g7O0FBRUQsZ0JBQU1DLE9BQU9DLEtBQUtELElBQWxCOztBQUVBLGdCQUFJQSxTQUFTLGFBQWIsRUFBNEI7QUFDeEIsb0JBQU1FLFFBQVEsa0JBQVFDLElBQVIsQ0FBYUMsS0FBYixDQUFtQkgsS0FBS0ksS0FBeEIsQ0FBZDtBQUNBLHFCQUFLLElBQUlDLElBQUksQ0FBUixFQUFXQyxNQUFNTCxNQUFNTSxNQUE1QixFQUFvQ0YsSUFBSUMsR0FBeEMsRUFBNkNELEdBQTdDLEVBQWtEO0FBQzlDLHdCQUFNRyxPQUFPUCxNQUFNSSxDQUFOLEVBQVNJLE9BQVQsQ0FBaUIsUUFBakIsRUFBMkIsRUFBM0IsQ0FBYjtBQUNBLHdCQUFNQyxnQkFBZ0JGLEtBQUtHLFdBQUwsRUFBdEI7O0FBRUEsd0JBQUksQ0FBQ2YsT0FBT2dCLDRCQUFQLENBQW9DRixhQUFwQyxDQUFMLEVBQXlEO0FBQ3JEZCwrQkFBT2dCLDRCQUFQLENBQW9DRixhQUFwQyxJQUFxREYsSUFBckQ7QUFDSCxxQkFGRCxNQUdLO0FBQ0QsNEJBQUlaLE9BQU9nQiw0QkFBUCxDQUFvQ0YsYUFBcEMsTUFBdURGLElBQTNELEVBQWlFO0FBQzdELGdDQUFNSyxTQUFTYixLQUFLYSxNQUFwQjtBQUNBLGdDQUFNQyxPQUFPRCxPQUFPRSxLQUFQLENBQWFELElBQTFCO0FBQ0EsZ0NBQU1FLGNBQWMsMEJBQWVGLElBQWYsRUFBcUJELE9BQU9JLEtBQVAsQ0FBYTFCLEdBQWxDLENBQXBCO0FBQ0EsZ0NBQU0yQixNQUFNRixZQUFZRyxPQUFaLENBQW9CWCxJQUFwQixJQUE0QixDQUF4Qzs7QUFFQSxnQ0FBTVksSUFBSXJDLE9BQU95QixJQUFQLEVBQWFaLE9BQU9nQiw0QkFBUCxDQUFvQ0YsYUFBcEMsQ0FBYixDQUFWOztBQUVBbEIsbUNBQU82QixJQUFQLENBQVl4QyxRQUFaLEVBQXNCO0FBQ2xCeUMsc0NBQU10QixJQURZO0FBRWxCdUIsMENBQVUxQyxRQUZRO0FBR2xCaUMsc0NBQU1BLElBSFk7QUFJbEJJLHFDQUFLQSxHQUphO0FBS2xCTSx5Q0FBU0osRUFBRWxDLEdBTE87QUFNbEJ1Qyw4Q0FBYyxNQUNSVCxZQUFZUCxPQUFaLENBQW9CRCxJQUFwQixFQUEwQixnQkFBTXBCLE9BQU4sQ0FBY29CLElBQWQsQ0FBMUIsQ0FEUSxHQUVSLElBRlEsR0FHUixnQkFBTWtCLElBQU4sQ0FBV04sRUFBRWpDLFFBQWI7QUFUWSw2QkFBdEI7QUFXQVMsbUNBQU9DLHlCQUFQO0FBQ0g7QUFDSjtBQUNKO0FBQ0o7QUFDSixTQXpDRDtBQTBDSCxLQWhEeUM7QUFBQSxDQUF6QixDQUFkIiwiZmlsZSI6InVuaWZ5aW5nLWZvbnQtZmFtaWx5LWNhc2Utc2Vuc2l0aXZlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSB1bmlmeWluZy1mb250LWZhbWlseS1jYXNlLXNlbnNpdGl2ZSDnmoTmo4DmtYvpgLvovpFcbiAqICAgICAgIDAzNjogW+W8uuWItl0gYGZvbnQtZmFtaWx5YCDkuI3ljLrliIblpKflsI/lhpnvvIzkvYblnKjlkIzkuIDkuKrpobnnm67kuK3vvIzlkIzmoLfnmoQgYEZhbWlseSBOYW1lYCDlpKflsI/lhpnlv4Xpobvnu5/kuIDjgIJcbiAqIEBhdXRob3IgaWVsZ25hdyh3dWppMDIyM0BnbWFpbC5jb20pXG4gKi9cblxuaW1wb3J0IGNoYWxrIGZyb20gJ2NoYWxrJztcbmltcG9ydCBwb3N0Y3NzIGZyb20gJ3Bvc3Rjc3MnO1xuXG5pbXBvcnQge2dldExpbmVDb250ZW50fSBmcm9tICcuLi91dGlsJztcblxuLyoqXG4gKiDlvZPliY3mlofku7bmiYDku6PooajnmoTop4TliJnlkI3np7BcbiAqXG4gKiBAY29uc3RcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmNvbnN0IFJVTEVOQU1FID0gJ3VuaWZ5aW5nLWZvbnQtZmFtaWx5LWNhc2Utc2Vuc2l0aXZlJztcblxuLyoqXG4gKiDplJnor6/nmoTkv6Hmga9cbiAqXG4gKiBAY29uc3RcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmNvbnN0IE1TRyA9ICdgZm9udC1mYW1pbHlgIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBpbiB0aGUgc2FtZSBwcm9qZWN0LCB0aGUgc2FtZWAgRmFtaWx5IE5hbWVgIGNhc2UgbXVzdCBiZSB1bmlmaWVkLic7XG5cbi8qKlxuICog6I635Y+W6ZSZ6K+v5L+h5oGvXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGN1ckZvbnRGYW1pbHkg5b2T5YmN5qOA5rWL55qE6L+Z5LiqIGZvbnQtZmFtaWx5IOWAvFxuICogQHBhcmFtIHtzdHJpbmd9IHByb2pGb250RmFtaWx5IOmhueebrue6p+WIq+WvueW6lOeahOi/meS4qiBmb250LWZhbWlseSDlgLxcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IOmUmeivr+S/oeaBr1xuICovXG5jb25zdCBnZXRNc2cgPSAoY3VyRm9udEZhbWlseSwgcHJvakZvbnRGYW1pbHkpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgICBtc2c6IE1TR1xuICAgICAgICAgICAgKyAnIEluIGN1cnJlbnRseSBwcm9qZWN0LCAnXG4gICAgICAgICAgICArICdgJ1xuICAgICAgICAgICAgKyBjdXJGb250RmFtaWx5XG4gICAgICAgICAgICArICdgIHNob3VsZCBiZSBgJ1xuICAgICAgICAgICAgKyAgIHByb2pGb250RmFtaWx5XG4gICAgICAgICAgICArICdgLicsXG4gICAgICAgIGNvbG9yTXNnOiBNU0dcbiAgICAgICAgICAgICsgJyBJbiBjdXJyZW50bHkgcHJvamVjdCwgJ1xuICAgICAgICAgICAgKyAnYCdcbiAgICAgICAgICAgICsgY2hhbGsubWFnZW50YShjdXJGb250RmFtaWx5KVxuICAgICAgICAgICAgKyAnYCBzaG91bGQgYmUgYCdcbiAgICAgICAgICAgICsgY2hhbGsubWFnZW50YShwcm9qRm9udEZhbWlseSlcbiAgICAgICAgICAgICsgJ2AuJ1xuICAgIH07XG59O1xuXG4vKipcbiAqIOWFt+S9k+eahOajgOa1i+mAu+i+kVxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIOWPguaVsFxuICogQHBhcmFtIHsqfSBvcHRzLnJ1bGVWYWwg5b2T5YmN6KeE5YiZ5YW35L2T6YWN572u55qE5YC8XG4gKiBAcGFyYW0ge3N0cmluZ30gb3B0cy5maWxlQ29udGVudCDmlofku7blhoXlrrlcbiAqIEBwYXJhbSB7c3RyaW5nfSBvcHRzLmZpbGVQYXRoIOaWh+S7tui3r+W+hFxuICovXG5leHBvcnQgY29uc3QgY2hlY2sgPSBwb3N0Y3NzLnBsdWdpbihSVUxFTkFNRSwgb3B0cyA9PlxuICAgIChjc3MsIHJlc3VsdCkgPT4ge1xuICAgICAgICBpZiAoIW9wdHMucnVsZVZhbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY3NzLndhbGtEZWNscyhkZWNsID0+IHtcbiAgICAgICAgICAgIGlmIChnbG9iYWwuQ1NTSElOVF9JTlZBTElEX0FMTF9DT1VOVCA+PSBvcHRzLm1heEVycm9yKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBwcm9wID0gZGVjbC5wcm9wO1xuXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ2ZvbnQtZmFtaWx5Jykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gcG9zdGNzcy5saXN0LnNwYWNlKGRlY2wudmFsdWUpO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJ0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0ID0gcGFydHNbaV0ucmVwbGFjZSgvWydcIixdL2csICcnKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFydExvd2VyQ2FzZSA9IHBhcnQudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWdsb2JhbC5DU1NISU5UX0ZPTlRGQU1JTFlfQ0FTRV9GTEFHW3BhcnRMb3dlckNhc2VdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwuQ1NTSElOVF9GT05URkFNSUxZX0NBU0VfRkxBR1twYXJ0TG93ZXJDYXNlXSA9IHBhcnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsLkNTU0hJTlRfRk9OVEZBTUlMWV9DQVNFX0ZMQUdbcGFydExvd2VyQ2FzZV0gIT09IHBhcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2UgPSBkZWNsLnNvdXJjZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5lID0gc291cmNlLnN0YXJ0LmxpbmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGluZUNvbnRlbnQgPSBnZXRMaW5lQ29udGVudChsaW5lLCBzb3VyY2UuaW5wdXQuY3NzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSBsaW5lQ29udGVudC5pbmRleE9mKHBhcnQpICsgMTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBnZXRNc2cocGFydCwgZ2xvYmFsLkNTU0hJTlRfRk9OVEZBTUlMWV9DQVNFX0ZMQUdbcGFydExvd2VyQ2FzZV0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lndhcm4oUlVMRU5BTUUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogZGVjbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZU5hbWU6IFJVTEVOQU1FLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBsaW5lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w6IGNvbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbS5tc2csXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yTWVzc2FnZTogJ2AnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGxpbmVDb250ZW50LnJlcGxhY2UocGFydCwgY2hhbGsubWFnZW50YShwYXJ0KSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJ2AgJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjaGFsay5ncmV5KG0uY29sb3JNc2cpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuKTtcbiJdfQ==