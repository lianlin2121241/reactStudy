'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.check = undefined;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _util = require('../util');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * 当前文件所代表的规则名称
 *
 * @const
 * @type {string}
 */
var RULENAME = 'require-after-space';

/**
 * 冒号
 *
 * @const
 * @type {string}
 */
/**
 * @file require-after-space 的检测逻辑
 *       `:` 对应 004: [强制] `属性名` 与之后的 `:` 之间不允许包含空格， `:` 与 `属性值` 之间必须包含空格。
 *       `,` 对应 005: [强制] `列表型属性值` 书写在单行时，`,` 后必须跟一个空格。
 * @author ielgnaw(wuji0223@gmail.com)
 */

var COLON = ':';

/**
 * 逗号
 *
 * @const
 * @type {string}
 */
var COMMA = ',';

/**
 * 匹配 css 属性值的 url(...);
 *
 * @const
 * @type {RegExp}
 */
var PATTERN_URI = /url\(["']?([^\)"']+)["']?\)/i;

/**
 * 冒号的错误信息
 *
 * @const
 * @type {string}
 */
var COLON_MSG = '' + 'Disallow contain spaces between the `attr-name` and `:`, ' + 'Must contain spaces between `:` and `attr-value`';

/**
 * 逗号的错误信息
 *
 * @const
 * @type {string}
 */
var COMMA_MSG = 'Must contain spaces after `,` in `attr-value`';

var arrayProto = Array.prototype;

/**
 * 具体的检测逻辑
 *
 * @param {Object} opts 参数
 * @param {*} opts.ruleVal 当前规则具体配置的值
 * @param {string} opts.fileContent 文件内容
 * @param {string} opts.filePath 文件路径
 */
var check = exports.check = _postcss2.default.plugin(RULENAME, function (opts) {
    return function (css, result) {
        var ruleVal = opts.ruleVal;
        var realRuleVal = [];
        arrayProto.push[Array.isArray(ruleVal) ? 'apply' : 'call'](realRuleVal, ruleVal);

        if (realRuleVal.length) {

            css.walkDecls(function (decl) {
                if (global.CSSHINT_INVALID_ALL_COUNT >= opts.maxError) {
                    return;
                }

                var source = decl.source;
                var line = source.start.line;
                var lineContent = (0, _util.getLineContent)(line, source.input.css) || '';

                if (realRuleVal.indexOf(COLON) !== -1) {
                    var between = decl.raws.between;

                    if (between.slice(0, 1) !== ':' // `属性名` 与之后的 `:` 之间包含空格了
                    || between.slice(-1) === ':' // `:` 与 `属性值` 之间不包含空格
                    ) {
                            var colorStr = decl.prop + decl.raws.between + decl.value;
                            result.warn(RULENAME, {
                                node: decl,
                                ruleName: RULENAME,
                                errorChar: COLON,
                                line: line,
                                message: COLON_MSG,
                                colorMessage: '`' + lineContent.replace(colorStr, _chalk2.default.magenta(colorStr)) + '` ' + _chalk2.default.grey(COLON_MSG)
                            });
                            global.CSSHINT_INVALID_ALL_COUNT++;
                        }
                }

                if (realRuleVal.indexOf(COMMA) !== -1) {

                    var value = decl.value;

                    // 排除掉 uri 的情况，例如
                    // background-image: url(data:image/gif;base64,R0lGODlhCAAHAIABAGZmZv...);
                    // background-image: 2px 2px url(data:image/gif;base64,R0lGODlhCAAHAIABAGZmZv...);
                    // background-image: url(data:image/gif;base64,R0lGODlhCAAHAIABAGZmZv...) 2px 2px;
                    if (!PATTERN_URI.test(value)) {
                        var items = lineContent.split(';');
                        for (var j = 0, jLen = items.length; j < jLen; j++) {
                            var s = items[j];
                            if (s.indexOf(',') > -1 && /.*,(?!\s)/.test(s) && s.length !== lineContent.length // s.length === lineContent.length 的情况表示当前行结束了
                            ) {
                                    result.warn(RULENAME, {
                                        node: decl,
                                        ruleName: RULENAME,
                                        errorChar: COMMA,
                                        line: line,
                                        message: COMMA_MSG,
                                        colorMessage: '`' + lineContent.replace(value, _chalk2.default.magenta(value)) + '` ' + _chalk2.default.grey(COMMA_MSG)
                                    });
                                    global.CSSHINT_INVALID_ALL_COUNT++;
                                }
                        }
                    }
                }
            });
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ydWxlL3JlcXVpcmUtYWZ0ZXItc3BhY2UuanMiXSwibmFtZXMiOlsiUlVMRU5BTUUiLCJDT0xPTiIsIkNPTU1BIiwiUEFUVEVSTl9VUkkiLCJDT0xPTl9NU0ciLCJDT01NQV9NU0ciLCJhcnJheVByb3RvIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJjaGVjayIsInBsdWdpbiIsImNzcyIsInJlc3VsdCIsInJ1bGVWYWwiLCJvcHRzIiwicmVhbFJ1bGVWYWwiLCJwdXNoIiwiaXNBcnJheSIsImxlbmd0aCIsIndhbGtEZWNscyIsImdsb2JhbCIsIkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQiLCJtYXhFcnJvciIsInNvdXJjZSIsImRlY2wiLCJsaW5lIiwic3RhcnQiLCJsaW5lQ29udGVudCIsImlucHV0IiwiaW5kZXhPZiIsImJldHdlZW4iLCJyYXdzIiwic2xpY2UiLCJjb2xvclN0ciIsInByb3AiLCJ2YWx1ZSIsIndhcm4iLCJub2RlIiwicnVsZU5hbWUiLCJlcnJvckNoYXIiLCJtZXNzYWdlIiwiY29sb3JNZXNzYWdlIiwicmVwbGFjZSIsIm1hZ2VudGEiLCJncmV5IiwidGVzdCIsIml0ZW1zIiwic3BsaXQiLCJqIiwiakxlbiIsInMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFPQTs7OztBQUNBOzs7O0FBRUE7Ozs7QUFFQTs7Ozs7O0FBTUEsSUFBTUEsV0FBVyxxQkFBakI7O0FBRUE7Ozs7OztBQXBCQTs7Ozs7OztBQTBCQSxJQUFNQyxRQUFRLEdBQWQ7O0FBRUE7Ozs7OztBQU1BLElBQU1DLFFBQVEsR0FBZDs7QUFFQTs7Ozs7O0FBTUEsSUFBTUMsY0FBYyw4QkFBcEI7O0FBRUE7Ozs7OztBQU1BLElBQU1DLFlBQVksS0FDWiwyREFEWSxHQUVaLGtEQUZOOztBQUlBOzs7Ozs7QUFNQSxJQUFNQyxZQUFZLCtDQUFsQjs7QUFFQSxJQUFNQyxhQUFhQyxNQUFNQyxTQUF6Qjs7QUFFQTs7Ozs7Ozs7QUFRTyxJQUFNQyx3QkFBUSxrQkFBUUMs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LEdBTVIsZ0JBQU1TLElBQU4sQ0FBV3ZDLFNBQVg7QUFaWSxxQ0FBdEI7QUFjQWUsMkNBQU9DLHlCQUFQO0FBQ0g7QUFDSjtBQUNKO0FBQ0o7QUFFSixhQXRFRDtBQXVFSDtBQUNKLEtBaEZ5QztBQUFBLENBQXpCLENBQWQiLCJmaWxlIjoicmVxdWlyZS1hZnRlci1zcGFjZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgcmVxdWlyZS1hZnRlci1zcGFjZSDnmoTmo4DmtYvpgLvovpFcbiAqICAgICAgIGA6YCDlr7nlupQgMDA0OiBb5by65Yi2XSBg5bGe5oCn5ZCNYCDkuI7kuYvlkI7nmoQgYDpgIOS5i+mXtOS4jeWFgeiuuOWMheWQq+epuuagvO+8jCBgOmAg5LiOIGDlsZ7mgKflgLxgIOS5i+mXtOW/hemhu+WMheWQq+epuuagvOOAglxuICogICAgICAgYCxgIOWvueW6lCAwMDU6IFvlvLrliLZdIGDliJfooajlnovlsZ7mgKflgLxgIOS5puWGmeWcqOWNleihjOaXtu+8jGAsYCDlkI7lv4Xpobvot5/kuIDkuKrnqbrmoLzjgIJcbiAqIEBhdXRob3IgaWVsZ25hdyh3dWppMDIyM0BnbWFpbC5jb20pXG4gKi9cblxuaW1wb3J0IGNoYWxrIGZyb20gJ2NoYWxrJztcbmltcG9ydCBwb3N0Y3NzIGZyb20gJ3Bvc3Rjc3MnO1xuXG5pbXBvcnQge2dldExpbmVDb250ZW50fSBmcm9tICcuLi91dGlsJztcblxuLyoqXG4gKiDlvZPliY3mlofku7bmiYDku6PooajnmoTop4TliJnlkI3np7BcbiAqXG4gKiBAY29uc3RcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmNvbnN0IFJVTEVOQU1FID0gJ3JlcXVpcmUtYWZ0ZXItc3BhY2UnO1xuXG4vKipcbiAqIOWGkuWPt1xuICpcbiAqIEBjb25zdFxuICogQHR5cGUge3N0cmluZ31cbiAqL1xuY29uc3QgQ09MT04gPSAnOic7XG5cbi8qKlxuICog6YCX5Y+3XG4gKlxuICogQGNvbnN0XG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5jb25zdCBDT01NQSA9ICcsJztcblxuLyoqXG4gKiDljLnphY0gY3NzIOWxnuaAp+WAvOeahCB1cmwoLi4uKTtcbiAqXG4gKiBAY29uc3RcbiAqIEB0eXBlIHtSZWdFeHB9XG4gKi9cbmNvbnN0IFBBVFRFUk5fVVJJID0gL3VybFxcKFtcIiddPyhbXlxcKVwiJ10rKVtcIiddP1xcKS9pO1xuXG4vKipcbiAqIOWGkuWPt+eahOmUmeivr+S/oeaBr1xuICpcbiAqIEBjb25zdFxuICogQHR5cGUge3N0cmluZ31cbiAqL1xuY29uc3QgQ09MT05fTVNHID0gJydcbiAgICArICdEaXNhbGxvdyBjb250YWluIHNwYWNlcyBiZXR3ZWVuIHRoZSBgYXR0ci1uYW1lYCBhbmQgYDpgLCAnXG4gICAgKyAnTXVzdCBjb250YWluIHNwYWNlcyBiZXR3ZWVuIGA6YCBhbmQgYGF0dHItdmFsdWVgJztcblxuLyoqXG4gKiDpgJflj7fnmoTplJnor6/kv6Hmga9cbiAqXG4gKiBAY29uc3RcbiAqIEB0eXBlIHtzdHJpbmd9XG4gKi9cbmNvbnN0IENPTU1BX01TRyA9ICdNdXN0IGNvbnRhaW4gc3BhY2VzIGFmdGVyIGAsYCBpbiBgYXR0ci12YWx1ZWAnO1xuXG5jb25zdCBhcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlO1xuXG4vKipcbiAqIOWFt+S9k+eahOajgOa1i+mAu+i+kVxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIOWPguaVsFxuICogQHBhcmFtIHsqfSBvcHRzLnJ1bGVWYWwg5b2T5YmN6KeE5YiZ5YW35L2T6YWN572u55qE5YC8XG4gKiBAcGFyYW0ge3N0cmluZ30gb3B0cy5maWxlQ29udGVudCDmlofku7blhoXlrrlcbiAqIEBwYXJhbSB7c3RyaW5nfSBvcHRzLmZpbGVQYXRoIOaWh+S7tui3r+W+hFxuICovXG5leHBvcnQgY29uc3QgY2hlY2sgPSBwb3N0Y3NzLnBsdWdpbihSVUxFTkFNRSwgb3B0cyA9PlxuICAgIChjc3MsIHJlc3VsdCkgPT4ge1xuICAgICAgICBjb25zdCBydWxlVmFsID0gb3B0cy5ydWxlVmFsO1xuICAgICAgICBjb25zdCByZWFsUnVsZVZhbCA9IFtdO1xuICAgICAgICBhcnJheVByb3RvLnB1c2hbQXJyYXkuaXNBcnJheShydWxlVmFsKSA/ICdhcHBseScgOiAnY2FsbCddKHJlYWxSdWxlVmFsLCBydWxlVmFsKTtcblxuICAgICAgICBpZiAocmVhbFJ1bGVWYWwubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgIGNzcy53YWxrRGVjbHMoZGVjbCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGdsb2JhbC5DU1NISU5UX0lOVkFMSURfQUxMX0NPVU5UID49IG9wdHMubWF4RXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZSA9IGRlY2wuc291cmNlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpbmUgPSBzb3VyY2Uuc3RhcnQubGluZTtcbiAgICAgICAgICAgICAgICBjb25zdCBsaW5lQ29udGVudCA9IGdldExpbmVDb250ZW50KGxpbmUsIHNvdXJjZS5pbnB1dC5jc3MpIHx8ICcnO1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlYWxSdWxlVmFsLmluZGV4T2YoQ09MT04pICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBiZXR3ZWVuID0gZGVjbC5yYXdzLmJldHdlZW47XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGJldHdlZW4uc2xpY2UoMCwgMSkgIT09ICc6JyAvLyBg5bGe5oCn5ZCNYCDkuI7kuYvlkI7nmoQgYDpgIOS5i+mXtOWMheWQq+epuuagvOS6hlxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgYmV0d2Vlbi5zbGljZSgtMSkgPT09ICc6JyAvLyBgOmAg5LiOIGDlsZ7mgKflgLxgIOS5i+mXtOS4jeWMheWQq+epuuagvFxuICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yU3RyID0gZGVjbC5wcm9wICsgZGVjbC5yYXdzLmJldHdlZW4gKyBkZWNsLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lndhcm4oUlVMRU5BTUUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlOiBkZWNsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGVOYW1lOiBSVUxFTkFNRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNoYXI6IENPTE9OLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IGxpbmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogQ09MT05fTVNHLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yTWVzc2FnZTogJ2AnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgbGluZUNvbnRlbnQucmVwbGFjZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yU3RyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbGsubWFnZW50YShjb2xvclN0cilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICdgICdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjaGFsay5ncmV5KENPTE9OX01TRylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLkNTU0hJTlRfSU5WQUxJRF9BTExfQ09VTlQrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChyZWFsUnVsZVZhbC5pbmRleE9mKENPTU1BKSAhPT0gLTEpIHtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGRlY2wudmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8g5o6S6Zmk5o6JIHVyaSDnmoTmg4XlhrXvvIzkvovlpoJcbiAgICAgICAgICAgICAgICAgICAgLy8gYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaENBQUhBSUFCQUdabVp2Li4uKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gYmFja2dyb3VuZC1pbWFnZTogMnB4IDJweCB1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQ0FBSEFJQUJBR1ptWnYuLi4pO1xuICAgICAgICAgICAgICAgICAgICAvLyBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQ0FBSEFJQUJBR1ptWnYuLi4pIDJweCAycHg7XG4gICAgICAgICAgICAgICAgICAgIGlmICghUEFUVEVSTl9VUkkudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gbGluZUNvbnRlbnQuc3BsaXQoJzsnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBqTGVuID0gaXRlbXMubGVuZ3RoOyBqIDwgakxlbjsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IGl0ZW1zW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzLmluZGV4T2YoJywnKSA+IC0xXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIC8uKiwoPyFcXHMpLy50ZXN0KHMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIHMubGVuZ3RoICE9PSBsaW5lQ29udGVudC5sZW5ndGggLy8gcy5sZW5ndGggPT09IGxpbmVDb250ZW50Lmxlbmd0aCDnmoTmg4XlhrXooajnpLrlvZPliY3ooYznu5PmnZ/kuoZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lndhcm4oUlVMRU5BTUUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGU6IGRlY2wsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlTmFtZTogUlVMRU5BTUUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNoYXI6IENPTU1BLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbGluZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IENPTU1BX01TRyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yTWVzc2FnZTogJ2AnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBsaW5lQ29udGVudC5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbGsubWFnZW50YSh2YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnYCAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjaGFsay5ncmV5KENPTU1BX01TRylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbC5DU1NISU5UX0lOVkFMSURfQUxMX0NPVU5UKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbik7XG4iXX0=