'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.loadConfig = loadConfig;

var _manis = require('manis');

var _manis2 = _interopRequireDefault(_manis);

var _path = require('path');

var _jsYaml = require('js-yaml');

var _jsYaml2 = _interopRequireDefault(_jsYaml);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

'use strict'; /**
               * @file 对配置文件的读取合并等等
               * @author ielgnaw(wuji0223@gmail.com)
               */

var STORAGE = null;

// const JSON_YAML_REG = /.+\.(json|yml)$/i;

/**
 * 获取 merge 后的配置文件
 *
 * @param {string} filePath 待检查的文件路径，根据这个路径去寻找用户自定义的配置文件，然后和默认的配置文件 merge
 * @param {boolean} refresh 是否强制刷新内存中已经存在的配置
 *
 * @return {Object} merge 后的配置对象
 */
function loadConfig(filePath, refresh) {
    if (!refresh && STORAGE) {
        return STORAGE;
    }

    var manis = new _manis2.default({
        files: ['.csshintrc'],
        loader: function loader(content) {
            if (!content) {
                return '';
            }
            var ret = void 0;
            try {
                ret = _jsYaml2.default.load(content);
            } catch (e) {}
            // if (basename(filePath) === '.csshintrc') {
            //     return JSON.parse(stripJSONComments(content));
            // }
            //
            // let match = filePath.match(JSON_YAML_REG);
            //
            // if (match) {
            //     let suffix = match[1];
            //     if (suffix === 'json') {
            //         return JSON.parse(stripJSONComments(content));
            //     }
            //     else if (suffix === 'yml') {
            //         return yaml.load(content);
            //     }
            // }
            return ret;
        }
    });

    manis.setDefault((0, _path.join)(__dirname, './csshint.yml'));

    STORAGE = manis.from(filePath);

    return STORAGE;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25maWcuanMiXSwibmFtZXMiOlsibG9hZENvbmZpZyIsIlNUT1JBR0UiLCJmaWxlUGF0aCIsInJlZnJlc2giLCJtYW5pcyIsImZpbGVzIiwibG9hZGVyIiwiY29udGVudCIsInJldCIsImxvYWQiLCJlIiwic2V0RGVmYXVsdCIsIl9fZGlybmFtZSIsImZyb20iXSwibWFwcGluZ3MiOiI7Ozs7O1FBdUJnQkEsVSxHQUFBQSxVOztBQWxCaEI7Ozs7QUFDQTs7QUFDQTs7Ozs7O0FBRUEsYSxDQVRBOzs7OztBQVdBLElBQUlDLFVBQVUsSUFBZDs7QUFFQTs7QUFFQTs7Ozs7Ozs7QUFRTyxTQUFTRCxVQUFULENBQW9CRSxRQUFwQixFQUE4QkMsT0FBOUIsRUFBdUM7QUFDMUMsUUFBSSxDQUFDQSxPQUFELElBQVlGLE9BQWhCLEVBQXlCO0FBQ3JCLGVBQU9BLE9BQVA7QUFDSDs7QUFFRCxRQUFJRyxRQUFRLG9CQUFVO0FBQ2xCQyxlQUFPLENBQ0gsWUFERyxDQURXO0FBSWxCQyxjQUprQixrQkFJWEMsT0FKVyxFQUlGO0FBQ1osZ0JBQUksQ0FBQ0EsT0FBTCxFQUFjO0FBQ1YsdUJBQU8sRUFBUDtBQUNIO0FBQ0QsZ0JBQUlDLFlBQUo7QUFDQSxnQkFBSTtBQUNBQSxzQkFBTSxpQkFBS0MsSUFBTCxDQUFVRixPQUFWLENBQU47QUFDSCxhQUZELENBR0EsT0FBT0csQ0FBUCxFQUFVLENBQUU7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBT0YsR0FBUDtBQUNIO0FBN0JpQixLQUFWLENBQVo7O0FBZ0NBSixVQUFNTyxVQUFOLENBQWlCLGdCQUFLQyxTQUFMLEVBQWdCLGVBQWhCLENBQWpCOztBQUVBWCxjQUFVRyxNQUFNUyxJQUFOLENBQVdYLFFBQVgsQ0FBVjs7QUFFQSxXQUFPRCxPQUFQO0FBQ0giLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSDlr7nphY3nva7mlofku7bnmoTor7vlj5blkIjlubbnrYnnrYlcbiAqIEBhdXRob3IgaWVsZ25hdyh3dWppMDIyM0BnbWFpbC5jb20pXG4gKi9cblxuaW1wb3J0IE1hbmlzIGZyb20gJ21hbmlzJztcbmltcG9ydCB7am9pbn0gZnJvbSAncGF0aCc7XG5pbXBvcnQgeWFtbCBmcm9tICdqcy15YW1sJztcblxuJ3VzZSBzdHJpY3QnO1xuXG5sZXQgU1RPUkFHRSA9IG51bGw7XG5cbi8vIGNvbnN0IEpTT05fWUFNTF9SRUcgPSAvLitcXC4oanNvbnx5bWwpJC9pO1xuXG4vKipcbiAqIOiOt+WPliBtZXJnZSDlkI7nmoTphY3nva7mlofku7ZcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZmlsZVBhdGgg5b6F5qOA5p+l55qE5paH5Lu26Lev5b6E77yM5qC55o2u6L+Z5Liq6Lev5b6E5Y675a+75om+55So5oi36Ieq5a6a5LmJ55qE6YWN572u5paH5Lu277yM54S25ZCO5ZKM6buY6K6k55qE6YWN572u5paH5Lu2IG1lcmdlXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHJlZnJlc2gg5piv5ZCm5by65Yi25Yi35paw5YaF5a2Y5Lit5bey57uP5a2Y5Zyo55qE6YWN572uXG4gKlxuICogQHJldHVybiB7T2JqZWN0fSBtZXJnZSDlkI7nmoTphY3nva7lr7nosaFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvYWRDb25maWcoZmlsZVBhdGgsIHJlZnJlc2gpIHtcbiAgICBpZiAoIXJlZnJlc2ggJiYgU1RPUkFHRSkge1xuICAgICAgICByZXR1cm4gU1RPUkFHRTtcbiAgICB9XG5cbiAgICBsZXQgbWFuaXMgPSBuZXcgTWFuaXMoe1xuICAgICAgICBmaWxlczogW1xuICAgICAgICAgICAgJy5jc3NoaW50cmMnXG4gICAgICAgIF0sXG4gICAgICAgIGxvYWRlcihjb250ZW50KSB7XG4gICAgICAgICAgICBpZiAoIWNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcmV0O1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXQgPSB5YW1sLmxvYWQoY29udGVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge31cbiAgICAgICAgICAgIC8vIGlmIChiYXNlbmFtZShmaWxlUGF0aCkgPT09ICcuY3NzaGludHJjJykge1xuICAgICAgICAgICAgLy8gICAgIHJldHVybiBKU09OLnBhcnNlKHN0cmlwSlNPTkNvbW1lbnRzKGNvbnRlbnQpKTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBsZXQgbWF0Y2ggPSBmaWxlUGF0aC5tYXRjaChKU09OX1lBTUxfUkVHKTtcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgIC8vICAgICBsZXQgc3VmZml4ID0gbWF0Y2hbMV07XG4gICAgICAgICAgICAvLyAgICAgaWYgKHN1ZmZpeCA9PT0gJ2pzb24nKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKHN0cmlwSlNPTkNvbW1lbnRzKGNvbnRlbnQpKTtcbiAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAvLyAgICAgZWxzZSBpZiAoc3VmZml4ID09PSAneW1sJykge1xuICAgICAgICAgICAgLy8gICAgICAgICByZXR1cm4geWFtbC5sb2FkKGNvbnRlbnQpO1xuICAgICAgICAgICAgLy8gICAgIH1cbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIG1hbmlzLnNldERlZmF1bHQoam9pbihfX2Rpcm5hbWUsICcuL2Nzc2hpbnQueW1sJykpO1xuXG4gICAgU1RPUkFHRSA9IG1hbmlzLmZyb20oZmlsZVBhdGgpO1xuXG4gICAgcmV0dXJuIFNUT1JBR0U7XG59XG4iXX0=